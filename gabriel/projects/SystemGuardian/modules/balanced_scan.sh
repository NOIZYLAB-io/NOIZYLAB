#!/bin/zsh
###############################################################################
# BALANCED_SCAN.SH ‚Äî SUPER STRONG TURBO SYSTEM SCANNER
# DO NOT TAKE NO FOR AN ANSWER üî•
###############################################################################
set -e
trap 'echo "‚ö†Ô∏è  Scan issue at line $LINENO ‚Äî continuing..." >&2' ERR

echo "üî•üî•üî• TURBO BALANCED SCAN: FULL SYSTEM ANALYSIS üî•üî•üî•"
echo ""

# -----------------------------------------------------------------------------
# 1. DISK USAGE (detailed)
# -----------------------------------------------------------------------------
echo "üìÄ [DISK SCAN]"
echo "----------------------------------------------"
df -h | grep -E "^/dev/|Filesystem" || df -h
echo ""

# -----------------------------------------------------------------------------
# 2. MEMORY PRESSURE (aggressive check)
# -----------------------------------------------------------------------------
echo "üß† [MEMORY SCAN]"
echo "----------------------------------------------"
for i in 1 2 3; do
  memory_pressure 2>/dev/null && break || sleep 1
done
vm_stat 2>/dev/null | head -10 || true
echo ""

# -----------------------------------------------------------------------------
# 3. CPU USAGE (detailed, retry)
# -----------------------------------------------------------------------------
echo "‚ö° [CPU SCAN]"
echo "----------------------------------------------"
for i in 1 2 3; do
  top -l 1 -n 10 2>/dev/null | head -20 && break || sleep 1
done
echo ""

# -----------------------------------------------------------------------------
# 4. NETWORK CHECK (multiple targets, retry)
# -----------------------------------------------------------------------------
echo "üåê [NETWORK SCAN]"
echo "----------------------------------------------"
NETWORK_OK=0
for target in 8.8.8.8 1.1.1.1 208.67.222.222; do
  for i in 1 2 3; do
    if ping -c 1 -W 2 "$target" >/dev/null 2>&1; then
      echo "Network ($target): ‚úÖ OK"
      NETWORK_OK=1
      break 2
    fi
    sleep 1
  done
done
if [ $NETWORK_OK -eq 0 ]; then
  echo "Network: ‚ùå ALL TARGETS UNREACHABLE"
fi
echo ""

# -----------------------------------------------------------------------------
# 5. RUNAWAY PROCESS CHECK
# -----------------------------------------------------------------------------
echo "üîç [RUNAWAY PROCESS SCAN]"
echo "----------------------------------------------"
ps aux | awk 'NR>1 {if ($3 > 30.0 || $4 > 30.0) print "‚ö†Ô∏è  PID:", $2, "CPU:", $3"% MEM:", $4"%", $11}' || true
echo ""

# -----------------------------------------------------------------------------
# FINAL REPORT
# -----------------------------------------------------------------------------
echo "============================================="
echo "üî• TURBO BALANCED SCAN COMPLETE üî•"
echo "============================================="
echo ""

exit 0

