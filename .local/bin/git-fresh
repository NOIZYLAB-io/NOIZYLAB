#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# git-fresh - Clean up local branches that are gone from remote
# Usage: git fresh
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e

echo "ðŸ”„ Fetching and pruning..."
git fetch --all --prune

echo ""
echo "ðŸ—‘ï¸  Finding merged/gone branches..."

# Get branches that are gone from remote
GONE_BRANCHES=$(git branch -vv | grep ': gone]' | awk '{print $1}')

if [[ -z "$GONE_BRANCHES" ]]; then
    echo "âœ¨ No stale branches found!"
    exit 0
fi

echo "Branches to delete:"
echo "$GONE_BRANCHES" | while read branch; do
    echo "  - $branch"
done

echo ""
read -p "Delete these branches? [y/N] " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "$GONE_BRANCHES" | while read branch; do
        git branch -D "$branch" 2>/dev/null && echo "  âœ“ Deleted $branch"
    done
    echo ""
    echo "âœ¨ Cleanup complete!"
else
    echo "Aborted."
fi
