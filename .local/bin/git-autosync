#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# git-autosync - Automated commit and push to remote
# Usage: git autosync [message]
# Runs from any git repo - auto-detects and syncs
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e

# Check if we're in a git repo
if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    echo "âŒ Not a git repository"
    exit 1
fi

# Get repo root
REPO_ROOT=$(git rev-parse --show-toplevel)
REPO_NAME=$(basename "$REPO_ROOT")
BRANCH=$(git branch --show-current)
REMOTE=$(git remote | head -1)

# Custom message or auto-generate
if [[ -n "$1" ]]; then
    MESSAGE="$*"
else
    # Auto-generate message with timestamp
    TIMESTAMP=$(date "+%Y-%m-%d %H:%M:%S")
    MESSAGE="sync: Auto-sync $TIMESTAMP"
fi

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”„ Git AutoSync"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  Repo:   $REPO_NAME"
echo "  Branch: $BRANCH"
echo "  Remote: $REMOTE"
echo ""

# Check for changes
if git diff --quiet && git diff --staged --quiet && [[ -z $(git ls-files --others --exclude-standard) ]]; then
    echo "âœ¨ No changes to sync"
    exit 0
fi

# Show what's being committed
echo "ğŸ“ Changes:"
git status -s
echo ""

# Stage all changes
echo "ğŸ“¦ Staging all changes..."
git add -A

# Commit
echo "ğŸ’¾ Committing: $MESSAGE"
git commit -m "$MESSAGE" --no-verify || {
    echo "âš ï¸  Nothing to commit"
    exit 0
}

# Push
echo "ğŸš€ Pushing to $REMOTE/$BRANCH..."
git push "$REMOTE" "$BRANCH" --no-verify

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Synced successfully!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
