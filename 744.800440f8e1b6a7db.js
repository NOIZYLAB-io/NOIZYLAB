"use strict";(self.webpackChunkfolder_workbench=self.webpackChunkfolder_workbench||[]).push([[744],{30744:(e,t,a)=>{a.r(t),a.d(t,{EditorToolbar:()=>It,ScriptEditor:()=>G,addExternalPackage:()=>j,addPackagesToEditor:()=>k,fetchExternalPackageList:()=>w,fetchPackmanAuthToken:()=>C,fetchScriptContent:()=>v,getExternalPackageName:()=>R,getExternalPackageTooltipText:()=>L,getExternalPackageUrl:()=>M,getLocalExternalPackageData:()=>O,isExternalPackageValid:()=>N,mergeUniqueExternalPackages:()=>D,parseRequiredPackage:()=>S,trackPackageSearch:()=>We,trackPackageSelect:()=>He,trackPackagesOnSend:()=>tt,trackPackagesSaved:()=>et,trackUpdatePackageVersion:()=>Ye,trackViewInRegistry:()=>Qe});var n=a(40540),r=a.n(n),i=a(35736),s=a(1590),o=a(52322);const c=(0,n.lazy)((0,s.loadRemoteModule)("code-editor/CodeEditor")),l=r().forwardRef(((e,t)=>(0,o.jsx)(n.Suspense,{fallback:(0,o.jsx)(i.Z,{}),children:(0,o.jsx)(c,Object.assign({},e,{ref:t}))})));var d=a(34583),g=a(38053);const p={"pre-script":async()=>(await a.e(1394).then(a.t.bind(a,11394,17))).default,"tests-script":async()=>(await a.e(6773).then(a.t.bind(a,16773,17))).default};var u=a(98276);const h=e=>e.charAt(0).toUpperCase()+e.slice(1),y=e=>"string"==typeof e?e:"object"==typeof e?JSON.stringify(e):String(e);var m=a(97201);const k=async(e,t,a)=>{const n=`const ${(0,d.camelCase)(e)} = pm.require('${t}');\n`;a.executeEdits("execute-edits",[{range:{startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1},text:n,forceMoveMarkers:!0}]);const r={lineNumber:1,column:n.length+1};a.setPosition(r),a.pushUndoStop()},v=async(e,t)=>{try{return await m.cacheClient.fetchQuery((0,g.getScriptQuery)(e,t))}catch(e){throw console.error("Error fetching script content:",e),e}};var P=a(97699),E=a.n(P);const x=e=>{const t=(e.includes(":")?e.split(":")[1]:e).lastIndexOf("@");return-1===t||0===t},f=e=>{const t=e.lastIndexOf("@");return{name:t>0?e.slice(0,Math.max(0,t)):e,version:t>0?e.slice(Math.max(0,t+1)):void 0}},b=Object.values(g.PackageRegistry),_=256;function S(e){const[t,a]=e.split(":");if(!a||e.length>_||!b.includes(t))return null;const{version:n}=f(a);return void 0===n||E().valid(n)?{packageRegistry:t,packageIdentifier:a}:null}const N=e=>!!S(e),R=e=>x(e)?e:e.slice(0,Math.max(0,e.lastIndexOf("@")));var A=a(21466);const I="https://www.npmjs.com/package",T="https://jsr.io";async function C(){try{return await A.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"FETCH_PACKMAN_AUTH_TOKEN",payload:void 0})}catch(e){throw console.error("Error fetching Packman auth token:",e),e}}async function j(e,t,a=!1,n=!1){try{return await A.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"ADD_PACKAGE",payload:{packageName:e,updateToLatest:t,isSaveDisabled:a,forceSave:n}})}catch(e){throw console.error("Error Adding package:",e),e}}async function O(){try{return await A.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"GET_LOCAL_EXTERNAL_PACKAGE_DATA",payload:void 0})}catch(e){throw console.error("Error fetching external package local data:",e),e}}async function w(e){try{return await m.cacheClient.ensureQueryData((0,g.searchExternalPackagesQuery)(e))}catch(e){throw console.error("Error fetching external package list:",e),e}}function L(e){return e===g.PackageRegistry.NPM?"View in NPM":"View in JSR"}function D(e){const t=new Map;for(const a of e){const e=`${a.registry}:${a.name}`;t.has(e)||t.set(e,a)}return[...t.values()]}function M({registry:e,name:t,version:a}){return e===g.PackageRegistry.NPM?`${I}/${t}/v/${a}`:`${T}/${t}@${a}`}const Z=["jsLib","node","postman-collection","chai"],G=(0,n.forwardRef)((({content:e,onChange:t,onSetPackages:r,isInternalPackagesEnabled:i,isExternalPackagesEnabled:s,type:c="pre-script",nativeEditorProps:m},k)=>{const[P,E]=(0,n.useState)([]),[x,f]=(0,n.useState)(null),[b,_]=(0,n.useState)([]),S=(0,n.useRef)(null),R=i||s,{data:I,globalNameToIdMap:T}=(0,g.usePackagesWithGlobalName)(),C=(()=>{const{data:e}=(0,u.useActiveAndDynamicVariables)();return(0,n.useCallback)(((t,a)=>{const n=new RegExp(/pm.(environment|globals|collectionVariables|variables).(((get|set|unset|has)\(('|").*))$/),r=t.getWordBeforePosition(a);let i=t.getLineContent(a.lineNumber);i&&(i=i.slice(0,Math.max(0,a.column-1)));let s=[];const o=n.exec(i);if(!o||o.length<6)return[];const c=o[1],l=e;let d=[];if(!l)return[];const g={globals:"globals",environment:"environment",collectionVariables:"collection"};if("variables"===c)d=l.filter((e=>y(e.key).toLowerCase().includes(r.word.toLowerCase())));else if(g[c]){const e=g[c];d=l.filter((t=>t.scope===e&&"dynamic"!==t.type&&y(t.key).toLowerCase().includes(r.word.toLowerCase())))}return p=d,u={startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn},s=p.map((e=>{let t={environment:"a",collection:"b",global:"c"}[e.scope]||"y";return"dynamic"===e.type?(t="z",{label:e.key,detail:`Details: ${y(e.description)}`,documentation:`Scope: ${h(e.scope)}\n\n`,insertText:e.key,range:u,sortText:`${t}-${e.key}`}):{label:e.key,detail:`Current: ${e.sessionValue}`,documentation:`Initial: ${y(e.value)} \nScope: ${h(e.scope)}\n\n`,insertText:e.key,range:u,sortText:`${t}-${e.key}`}})),s;var p,u}),[e])})(),{isNativeEditorSupported:O,initialize:w,dispose:L,editorState:D,focusDocument:M}=(0,A.useNativeScriptEditor)({onContentChange:e=>{null==U||U(e)},content:e,fileName:m.fileName,isPreRequestScript:"pre-script"===c,analyticsMetaData:{entityId:null==m?void 0:m.entityId,entityType:(null==m?void 0:m.entityType)||"request"},instructionsData:m.instructionsData,type:m.entityType||"request"}),G=async(e,t=!0)=>{const{parsedRequireStatements:n,validationErrors:o,parseError:c}=await async function(e){let t;const n=await async function(){return a.e(8511).then(a.t.bind(a,78511,23))}(),r=[],i=[];try{t=n.createSourceFile("code.js",e,n.ScriptTarget.Latest)}catch(e){return{parseError:!0}}return function e(t){if(n.isCallExpression(t)){const{expression:e}=t;if(n.isPropertyAccessExpression(e)&&n.isIdentifier(e.expression)&&"pm"===e.expression.text&&n.isIdentifier(e.name)&&"require"===e.name.text){const e=t.arguments[0];if(e&&n.isStringLiteral(e))r.push(e.text);else{const a=e&&n.getLineAndCharacterOfPosition(t.getSourceFile(),e.pos);i.push({message:"pm.require accepts only string literal as argument",startLineNumber:null==a?void 0:a.line,endLineNumber:null==a?void 0:a.line,startColumn:(null==a?void 0:a.character)+1,endColumn:(null==a?void 0:a.character)+1,severity:3})}}}n.forEachChild(t,e)}(t),{parsedRequireStatements:r,validationErrors:i}}(e);if(c||!n)return;o&&E(o);const l={};for(const e of n){if(i&&T){const t=T.get(e);t&&(l[e]={id:t})}s&&N(e)&&(l[e]={id:e},j(e,!1))}t&&r(l),(async e=>{try{const t=Object.entries(e).filter((([e])=>T.get(e))).map((([e,{id:t}])=>(async(e,t)=>{if(!S.current)throw new Error("Worker pool not initialized");const a=I.find((t=>t.id===e)),n=null==a?void 0:a.indexScript.id;if(!n)throw new Error(`Script ID not found for package: ${t}`);const r=await v(e,n),i=await S.current.execute({jsCode:r.contents.src,packageName:a.name});return{id:`${t}-${new Date(r.lastRetrievedAt).getTime()}`,content:i.result||""}})(t,e))),a=((e,t)=>{if(!x)return e;let a="";const n=new Set(Object.values(t).map((({id:e})=>e)));return a=`\n      ${a}\n      declare interface Postman { ${I.filter((e=>n.has(e.id))).map((e=>`require(name: '${null==e?void 0:e.globalName}'): typeof import('${null==e?void 0:e.name}');`)).join("\n")} }\n    `,[{id:`${x.id}-${Math.random()}`,content:`${x.content}\n      ${a}\n      `},...e]})((await Promise.all(t)).filter((e=>e.content)),e);_(a)}catch(e){console.error("Error adding package libraries:",e)}})(l)},F=(0,d.useDebouncedCallback)(G,1e3,{trailing:!0}),U=e=>{t(e),R&&F(e)};return(0,n.useEffect)((()=>(R&&e&&G(e,!1),i&&((async()=>{try{const e=await(0,d.createWorker)("script-parser-worker"),t=(0,d.createWorkerPool)((()=>e),3,1e4);S.current=t}catch(e){console.error("Failed to set up script parser worker pool:",e)}})(),(async e=>{try{const t={id:e,content:await p[e]()};return f(t),t}catch(e){return""}})(c)),()=>{var e;null==(e=S.current)||e.terminateWorkers()})),[i,s,c]),(0,o.jsxs)(o.Fragment,{children:[O?(0,o.jsx)(A.NativeScriptEditorButtons,{onInitialize:w,onClose:L,editorState:D,onFocus:M}):null,(0,o.jsx)(l,{ref:k,showNonPrintableCharacters:!0,fontSize:12,language:"javascript",codeCompletionProviders:[{provider:C}],wordWrap:!0,autoFormat:!0,value:e,onChange:U,typeDefinitionTypes:[...Z,...b],validationErrors:P,isPreRequestScript:"pre-script"===c})]})}));var F=a(59530),U=a.n(F),K=a(50297),V=a(80605),J=a(58560),$=a(20856),z=a(81397),q=a(93715),B=a(20684),X=a(43294),W=a(56880),Q=a(39245),Y=a(10099),H=a(63622),ee=a(45374),te=a(53018),ae=a(69325);const ne=U()(J.Z).withConfig({displayName:"empty-packages__PackageIconContainer",componentId:"sc-191m01n-0"})(["border-radius:var(--border-radius-max);background-color:var(--background-color-tertiary);padding:var(--spacing-l);& > i > svg{width:var(--size-s);height:var(--size-s);}"]),re=U()(J.Z).withConfig({displayName:"empty-packages__Container",componentId:"sc-191m01n-1"})(["margin:auto;text-align:center;"]),ie=U()(H.ZP).withConfig({displayName:"empty-packages__StyledText",componentId:"sc-191m01n-2"})(["font-weight:var(--text-font-weight-bold);"]),se=U()(J.Z).withConfig({displayName:"empty-packages__IconContainer",componentId:"sc-191m01n-3"})(["height:var(--size-s);width:var(--size-s);background-color:var(--background-color-secondary);align-items:center;justify-content:center;border-radius:var(--border-radius-default);& > i{display:inline-flex;}"]),oe=({isExternalPackagesEnabled:e,isPostmanPackagesEnabled:t})=>(0,o.jsxs)(re,{height:"100",width:"100%",direction:"column",gap:"spacing-l",alignItems:"center",justifyContent:"center",children:[(0,o.jsx)(ne,{alignItems:"center",justifyContent:"center",children:(0,o.jsx)(q.Z,{})}),(0,o.jsxs)(J.Z,{gap:"spacing-s",direction:"column",alignItems:"center",width:"100%",children:[(0,o.jsx)(ie,{color:"content-color-primary",children:"Script faster with packages"}),(0,o.jsx)(H.ZP,{children:e?"Search and add packages from":"Reuse scripts across your team with package library."}),e&&(0,o.jsxs)(J.Z,{alignItems:"center",gap:"spacing-s",children:[t&&(0,o.jsx)(se,{children:(0,o.jsx)(ee.Z,{color:"base-color-brand"})}),(0,o.jsx)(se,{children:(0,o.jsx)(te.Z,{})}),(0,o.jsx)(se,{children:(0,o.jsx)(ae.Z,{})})]})]})]});var ce=a(38171),le=a.n(ce);const de=U().div.withConfig({displayName:"divider__Divider",componentId:"sc-1280uce-0"})(["background-color:var(--border-color-default);",""],(({isVertical:e})=>e?(0,F.css)(["width:1px;height:100%;"]):(0,F.css)(["height:1px;width:100%;"])));var ge=a(74962),pe=a(98530),ue=a(34520);let he=function(e){return e.POSTMAN_PACKAGE="postman-package",e.SELECTED_POSTMAN_PACKAGE="selected-postman-package",e.NPM_PACKAGE="npm-package",e.SELECTED_NPM_PACKAGE="selected-npm-package",e.JSR_PACKAGE="jsr-package",e.SELECTED_JSR_PACKAGE="selected-jsr-package",e.NPM_LOADING="npm-loading",e.JSR_LOADING="jsr-loading",e.NPM_ERROR="npm-error",e.JSR_ERROR="jsr-error",e}({}),ye=function(e){return e.Packages="packages",e.Snippets="snippets",e}({});const me=U()(te.Z).withConfig({displayName:"icons__StyledBrandLogoNPM",componentId:"sc-1ixhehj-0"})(["& > svg{path{fill:revert-layer !important;}}"]),ke=U()(ae.Z).withConfig({displayName:"icons__StyledBrandLogoJSR",componentId:"sc-1ixhehj-1"})(["& > svg{path{fill:revert-layer !important;}}"]),ve=U()(J.Z).withConfig({displayName:"icons__IconContainer",componentId:"sc-1ixhehj-2"})(["position:relative;margin-top:3px;margin-right:6px;"]),Pe=U().i.withConfig({displayName:"icons__CustomIconContainer",componentId:"sc-1ixhehj-3"})(["position:absolute;top:var(--spacing-s);left:10px;& > svg{path{fill:revert-layer !important;}}"]),Ee=U()(J.Z).withConfig({displayName:"icons__LoaderIcon",componentId:"sc-1ixhehj-4"})(["height:8px;width:8px;position:absolute;top:11px;left:11px;background-color:var(--content-color-secondary);animation:loader 1s infinite;border-radius:50%;@keyframes loader{0%{background-color:var(--content-color-secondary);}100%{background-color:var(--content-color-tertiary);}}"]),xe=U()(q.Z).withConfig({displayName:"icons__SelectedPostmanPackage",componentId:"sc-1ixhehj-5"})(["& > svg{color:var(--content-color-primary);}"]),fe=(0,o.jsx)(Pe,{children:(0,o.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsxs)("g",{clipPath:"url(#clip0_652_12651)",children:[(0,o.jsx)("path",{d:"M9.5 5C9.5 7.48528 7.48528 9.5 5 9.5C2.51472 9.5 0.5 7.48528 0.5 5C0.5 2.51472 2.51472 0.5 5 0.5C7.48528 0.5 9.5 2.51472 9.5 5Z",fill:"#0265D2",stroke:"var(--background-color-primary)"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.85359 3.6869L4.1667 7.37379L2.14648 5.35357L2.85359 4.64646L4.1667 5.95958L7.14648 2.9798L7.85359 3.6869Z",fill:"white"})]}),(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:"clip0_652_12651",children:(0,o.jsx)("rect",{width:"10",height:"10",fill:"var(--background-color-primary)"})})})]})}),be=(0,o.jsx)(Pe,{children:(0,o.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsxs)("g",{clipPath:"url(#clip0_652_13929)",children:[(0,o.jsx)("path",{d:"M9.5 5C9.5 7.48528 7.48528 9.5 5 9.5C2.51472 9.5 0.5 7.48528 0.5 5C0.5 2.51472 2.51472 0.5 5 0.5C7.48528 0.5 9.5 2.51472 9.5 5Z",fill:"#EB2013",stroke:"var(--background-color-primary)"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.5 6V2H5.5V6H4.5ZM4.5 8V7H5.5V8H4.5Z",fill:"var(--background-color-primary)"})]}),(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:"clip0_652_13929",children:(0,o.jsx)("rect",{width:"10",height:"10",fill:"var(--background-color-primary)"})})})]})}),_e=({children:e,icon:t})=>(0,o.jsxs)(ve,{children:[e,t]}),Se={[he.POSTMAN_PACKAGE]:(0,o.jsx)(q.Z,{}),[he.SELECTED_POSTMAN_PACKAGE]:(0,o.jsx)(_e,{icon:fe,children:(0,o.jsx)(xe,{})}),[he.NPM_PACKAGE]:(0,o.jsx)(me,{}),[he.SELECTED_NPM_PACKAGE]:(0,o.jsx)(_e,{icon:fe,children:(0,o.jsx)(me,{})}),[he.JSR_PACKAGE]:(0,o.jsx)(ke,{}),[he.SELECTED_JSR_PACKAGE]:(0,o.jsx)(_e,{icon:fe,children:(0,o.jsx)(ke,{})}),[he.NPM_LOADING]:(0,o.jsx)(_e,{icon:(0,o.jsx)(Ee,{}),children:(0,o.jsx)(me,{})}),[he.JSR_LOADING]:(0,o.jsx)(_e,{icon:(0,o.jsx)(Ee,{}),children:(0,o.jsx)(ke,{})}),[he.NPM_ERROR]:(0,o.jsx)(_e,{icon:be,children:(0,o.jsx)(me,{})}),[he.JSR_ERROR]:(0,o.jsx)(_e,{icon:be,children:(0,o.jsx)(ke,{})})};var Ne=a(78476);class Re{constructor(){this.packages=[],this.isLoadingPackages=!1,this.packagesState=Ne.observable.map(),this.packageRegistrySearchFilter={[g.PackageRegistry.NPM]:!1,[g.PackageRegistry.JSR]:!1,[g.PackageRegistry.POSTMAN]:!1},(0,Ne.makeObservable)(this,{packages:Ne.observable,isLoadingPackages:Ne.observable,setPackages:Ne.action,setIsLoadingPackages:Ne.action,packageRegistrySearchFilter:Ne.observable,packagesState:Ne.observable})}setPackages(e){this.packages=e}setIsLoadingPackages(e){this.isLoadingPackages=e}setPackageRegistrySearchFilter(e){this.packageRegistrySearchFilter=e}updatePackageState(e,t){this.packagesState.set(e,Object.assign({},this.packagesState.get(e),t))}clearPackageState(){this.packagesState.clear()}}class Ae{constructor(){this.activeToolbarAction=null,this.searchQuery="",this.setActiveToolbarAction=e=>{this.activeToolbarAction=e},(0,Ne.makeObservable)(this,{activeToolbarAction:Ne.observable,setActiveToolbarAction:Ne.action,setSearchQuery:Ne.action,searchQuery:Ne.observable})}setSearchQuery(e){this.searchQuery=e}}const Ie=(0,n.createContext)({}),Te=({children:e})=>{const t=(0,n.useMemo)((()=>({packageListStore:new Re,editorToolbarStore:new Ae})),[]);return(0,o.jsx)(Ie.Provider,{value:t,children:e})};function Ce(){const e=(0,n.useContext)(Ie);if(!e)throw new Error("useEditorToolbarStore must be used within a EditorToolbarContextProvider");return e}function je(){const e=Ce().packageListStore;return{packages:e.packages,isLoadingPackages:e.isLoadingPackages,setIsLoadingPackages:t=>e.setIsLoadingPackages(t),setPackages:t=>e.setPackages(t),updatePackageState:(t,a)=>{e.updatePackageState(t,a)},clearPackageState:()=>e.clearPackageState(),packagesState:e.packagesState}}const Oe=U()(V.Z).withConfig({displayName:"option-item__HoverIconButton",componentId:"sc-smripq-0"})(["align-items:center;height:20px;width:20px;display:none;& > i > svg{path{fill:",";}}"," ",""],(({isDisabled:e})=>e?"var(--content-color-tertiary) !important":"var(--button-tertiary-content-color) !important"),(({isDisabled:e})=>!e&&"\n      &:hover {\n        i > svg {\n          path {\n            fill: var(--button-tertiary-hover-content-color) !important;\n          }\n        }\n      }\n    "),(({hoverBackgroundColor:e})=>e&&`\n      &:hover {\n        background-color: var(--${e});\n      }\n    `)),we=U()(V.Z).withConfig({displayName:"option-item__StyledButton",componentId:"sc-smripq-1"})(["align-items:flex-start;height:auto;justify-content:flex-start;padding:6px var(--spacing-s);"," &:hover ",",&:focus-visible ","{display:flex;}&:focus-visible{background-color:var(--highlight-background-color-secondary);color:var(--content-color-primary);box-shadow:unset;}& > span{"," text-align:left;line-height:0;}& > i{width:var(--size-xs);height:var(--size-xs);margin:3px 6px var(--spacing-zero) var(--spacing-zero);}",""],(({isExternal:e})=>e&&"\n      &:hover > i > svg {\n        path {\n          fill: revert-layer;\n        }\n      }\n    "),Oe,Oe,(({spanWidth:e})=>e&&`width: ${e};`),(({isSelected:e})=>e&&"\n      cursor: default;\n      & > i > svg {\n        path {\n          fill: var(--button-primary-content-color) !important;\n        }\n      }\n\n       &:hover, &:active, &:focus-visible {\n       background-color: transparent;\n      }\n      &:focus-visible {\n        background-color: var(--highlight-background-color-secondary);\n      }\n    ")),Le=U()(J.Z).withConfig({displayName:"option-item__ItemDetails",componentId:"sc-smripq-2"})(["flex:1;"]),De=U()(H.ZP).withConfig({displayName:"option-item__VersionText",componentId:"sc-smripq-3"})(["color:var(--content-color-secondary);border:1px solid var(--border-color-default);border-radius:var(--border-radius-default);padding:var(--spacing-zero) var(--spacing-xs);"]),Me=e=>{if(!e.description||!e.showDescription)return null;const{description:t,isTruncated:a}=function(e,t=80){if(e.length<=t)return{description:e,isTruncated:!1};const a=t-3;return{description:e.slice(0,a)+"...",isTruncated:!0}}(e.description);return a?(0,o.jsx)(H.ZP,{type:"body-small",maxLines:2,color:"content-color-secondary",children:(0,o.jsx)(z.Z,{content:e.description,openDelay:1e3,placement:"left-start",children:(0,o.jsx)("span",{children:t})})}):(0,o.jsx)(H.ZP,{type:"body-small",color:"content-color-secondary",children:t})},Ze=(0,K.observer)((({option:e,onSelect:t,onRefCallback:a})=>{var r;const{packagesState:i}=je(),{id:s,iconName:c,version:l,showDescription:d,isExternal:g,openItem:p,openItemTooltipText:u}=e,{iconName:h=c,isSelected:y=!1,iconTooltipText:m,refreshItem:k,refreshItemTooltipText:v,version:P}=null!=(r=i.get(s))?r:{};return(0,o.jsx)(we,{ref:a,"data-testid":"script-toolbar-list-item",type:"tertiary",icon:h?Se[h]:null,isExternal:g,tooltip:m&&(0,o.jsx)(z.Z,{isInteractive:(0,n.isValidElement)(m),content:m,placement:"left-start",openDelay:1e3}),text:(0,o.jsxs)(J.Z,{direction:"column",width:"100%",alignItems:"flex-start",children:[(0,o.jsxs)(J.Z,{gap:"spacing-xs",minWidth:"0",alignItems:"flex-start",width:"100%",justifyContent:"space-between",children:[l||P?(0,o.jsxs)(Le,{alignItems:"center",minWidth:"0",gap:"spacing-s",children:[(0,o.jsx)(H.ZP,{color:"content-color-primary",isTruncated:d,type:"body-medium",children:e.name}),(0,o.jsx)(De,{type:"body-small",isTruncated:d,children:null!=l?l:P})]}):(0,o.jsx)(H.ZP,{color:"content-color-primary",isTruncated:d,type:"body-medium",children:e.name}),(0,o.jsxs)(J.Z,{gap:"spacing-xs",children:[g&&y&&(0,o.jsx)(Oe,{isDisabled:!k,size:"small",tooltip:(0,o.jsx)(z.Z,{content:v,openDelay:1e3}),onClick:e=>{e.stopPropagation(),null==k||k(s)},icon:(0,o.jsx)(pe.Z,{}),type:"tertiary"}),p?(0,o.jsx)(Oe,{tooltip:(0,o.jsx)(z.Z,{content:null!=u?u:"View in package library",openDelay:1e3}),onClick:t=>{t.stopPropagation(),null==e.openItem||e.openItem(s)},icon:(0,o.jsx)(ue.Z,{}),type:"tertiary",hoverBackgroundColor:"highlight-background-color-tertiary"}):null]})]}),Me(e)]}),isSelected:y,onClick:y?void 0:()=>t(e),spanWidth:p?"90%":"100%"},s)})),Ge=U()(ge.Z).withConfig({displayName:"list-items__CategoryName",componentId:"sc-1poy7h2-0"})(["margin:var(--spacing-s) var(--spacing-zero) 6px var(--spacing-s) !important;"]),Fe=U()(J.Z).withConfig({displayName:"list-items__CategoryContainer",componentId:"sc-1poy7h2-1"})(["margin-bottom:var( --spacing-xs ) !important;"]),Ue=({options:e,onSelect:t,buttonRefs:a})=>{const i=(0,n.useMemo)((()=>{const t=new Map;for(const a of e){const e=a.category||"NA";t.has(e)||t.set(e,[]),t.get(e).push(a)}return t}),[e]),s=(e,t)=>{a.current[t]=e};return(0,o.jsx)(o.Fragment,{children:[...i.entries()].map((([e,a])=>(0,o.jsx)(r().Fragment,{children:"NA"===e?(0,o.jsx)(o.Fragment,{children:a.map(((e,a)=>(0,o.jsx)(Ze,{option:e,onSelect:t,onRefCallback:e=>s(e,a)},e.id)))}):(0,o.jsxs)(Fe,{direction:"column",children:[(0,o.jsx)(Ge,{color:"content-color-tertiary",type:"h6",text:e}),a.map(((e,a)=>(0,o.jsx)(Ze,{option:e,onSelect:t,onRefCallback:e=>s(e,a)},e.id)))]})},e)))})};var Ke=a(98529),Ve=a(99078);function Je(e){const t=e[g.PackageRegistry.NPM],a=e[g.PackageRegistry.JSR],n=e[g.PackageRegistry.POSTMAN];return t&&a?g.SearchExternalPackageRegistryFilter.ALL:t||a||n?t?g.SearchExternalPackageRegistryFilter.NPM:a?g.SearchExternalPackageRegistryFilter.JSR:null:g.SearchExternalPackageRegistryFilter.ALL}function $e(e){const t=e.lastIndexOf("@");if(-1===t)return!0;if(0===t)return!0;const a=e.slice(t+1).trim();return""===a||!!E().valid(a)}var ze=a(19578);function qe(e,t){switch(e){case g.PackageRegistry.NPM:return t?he.SELECTED_NPM_PACKAGE:he.NPM_PACKAGE;case g.PackageRegistry.JSR:return t?he.SELECTED_JSR_PACKAGE:he.JSR_PACKAGE;default:return t?he.SELECTED_POSTMAN_PACKAGE:he.POSTMAN_PACKAGE}}function Be(e){return e===g.PackageRegistry.NPM?he.NPM_LOADING:he.JSR_LOADING}const Xe=e=>{let t=!1,a=!1;for(const n of e)if((n.includes(g.PackageRegistry.NPM)||n.includes(g.PackageRegistry.JSR))&&(t=!0),n.includes(g.PackageRegistry.POSTMAN)&&(a=!0),t&&a)break;return t&&a?"both":t?"public":"postman"},We=async(e,t,a,n)=>{const{eventLabel:r,metaRegistry:i}=(e=>{const t=[];for(const[a,n]of Object.entries(e))n&&t.push(a);return 0===t.length||t.includes(g.PackageRegistry.NPM)&&t.includes(g.PackageRegistry.JSR)&&t.includes(g.PackageRegistry.POSTMAN)?{eventLabel:"all",metaRegistry:"npm,jsr,postman"}:t.includes(g.PackageRegistry.NPM)&&t.includes(g.PackageRegistry.JSR)?{eventLabel:"public",metaRegistry:"npm,jsr"}:t.includes(g.PackageRegistry.NPM)?{eventLabel:"public",metaRegistry:"npm"}:t.includes(g.PackageRegistry.JSR)?{eventLabel:"public",metaRegistry:"jsr"}:{eventLabel:"postman",metaRegistry:"postman"}})(e);W.AnalyticsService.addEventV2({category:"package_library",action:"search_package",label:r,value:1,entityType:n,meta:JSON.stringify({search_term:a,editor_mode:t,registry:i}),variantId:"ide"})},Qe=async(e,t,a,n)=>{W.AnalyticsService.addEventV2({category:"package_library",action:"view_in_registry",label:e,value:1,entityType:n,meta:JSON.stringify({package_name:t,package_id:a}),variantId:"ide"})},Ye=async(e,t)=>{const[a,n]=e.split(":");W.AnalyticsService.addEventV2({category:"package_library",action:"update_package_version",label:a,value:1,entityType:t,meta:JSON.stringify({package_name:n}),variantId:"ide"})},He=async(e,t)=>{W.AnalyticsService.addEventV2({category:"package_library",action:"select_package_from_search",label:e.isExternal?"public":"postman",value:1,entityType:t,meta:JSON.stringify({package_id:e.id,package_name:e.name,registry:e.registry}),variantId:"ide"})},et=async(e,t,a)=>{const n=Object.assign({},e,t),r=Object.keys(n);if(0!==r.length)for(const e of r){var i;const t=e.includes(g.PackageRegistry.NPM)||e.includes(g.PackageRegistry.JSR),[r,s]=e.split(":"),o=t?s:e,c=t?r:g.PackageRegistry.POSTMAN;W.AnalyticsService.addEventV2({category:"package_library",action:"save_package_to_request",label:c,value:1,entityType:a,meta:JSON.stringify({package_name:o,package_id:t||null==(i=n[e])?void 0:i.id}),variantId:"ide"})}},tt=async e=>{if(null!=e&&e.events)for(const n of e.events){var t,a;const r=Object.keys(null!=(t=null==n||null==(a=n.script)?void 0:a.packages)?t:{});if(0===r.length)continue;const i=Xe(r),s=r.join(",");"prerequest"===n.listen?W.AnalyticsService.addEventV2({action:"history_with_package",label:"pre_request",value:1,category:"package_library",entityType:"history",entityId:e.id,meta:JSON.stringify({packages:s,package_type:i}),variantId:"ide"}):"test"===n.listen&&W.AnalyticsService.addEventV2({action:"history_with_package",label:"post_request",value:1,category:"package_library",entityType:"history",entityId:e.id,meta:JSON.stringify({packages:s,package_type:i}),variantId:"ide"})}},at=({entityType:e})=>{const t=ze.Toast.getToasts(),a=Ce().packageListStore,{packages:n,setPackages:r,setIsLoadingPackages:i,packagesState:s,updatePackageState:o}=je(),c=(0,d.useDebouncedCallback)((async t=>{const o=Je(a.packageRegistrySearchFilter);if(o&&t&&$e(t))try{const a=await C();if(!a)return[];const i=(await w({query:t,registry:o,authToken:a})).map((t=>{const{registry:a,scope:n,name:r,version:i,description:o}=t,c=`${n?`@${n}/`:""}${r}`,l=`${a}:${c}@${i}`,d=s.get(l),g=(null==d?void 0:d.isSelected)||!1;return{id:l,name:c,version:i,registry:a,globalName:l,description:o,showDescription:!0,isSelected:g,isExternal:!0,openItemTooltipText:L(a),openItem:()=>{const t=M({registry:a,name:c,version:i});Qe(a,c,l,e),(0,Q.openExternalLink)(t)},iconName:qe(a,!1)}})),c=n.filter((e=>e.isExternal&&e.isSelected)).map((e=>{const t=i.find((({registry:t,name:a})=>t===e.registry&&a===e.name));return null!=t&&t.description?Object.assign({},e,{description:t.description}):e})),l=D([...c,...i]);return r([...n.filter((e=>!e.isExternal)),...l]),l}catch(e){return[]}finally{i(!1)}}),1e3,{trailing:!0}),l=(e,t)=>{var n,r;const i=null==(n=a.packagesState.get(e.id))?void 0:n.isSelected;return i===(null==(r=a.packagesState.get(t.id))?void 0:r.isSelected)?0:i?-1:1},p=(n,i,s,c,l)=>{const{allowUpdate:d,tooltipText:g}=function(e,t,a){return t?{allowUpdate:!1,tooltipText:"Package loading"}:a?{allowUpdate:!1,tooltipText:"Failed to load package"}:x(e)?{allowUpdate:!0,tooltipText:"Update to latest version"}:{allowUpdate:!1,tooltipText:"Version specified in script"}}(n,c,l);o(n,{refreshItemTooltipText:g,refreshItem:d?()=>((n,i,s)=>{o(n,{iconName:Be(s),iconTooltipText:void 0}),p(n,i,s,!0),j(n,!0).then((async({error:e})=>{if(e){const{packageIdentifier:e}=S(n)||{},{name:a}=e?f(e):{name:n};return t.addToast({title:"Package update failed",description:`Couldn't update ${a} to it's latest version`,status:"error"}),void p(n,i,s,!1)}const c=(await O())[n],l=c?S(c):null;if(!l)return;const{packageRegistry:d,packageIdentifier:g}=l;if(!d||!g||!c)return;const{version:u}=f(g);r(a.packages.map((e=>e.id===n?Object.assign({},e,{version:u}):e))),o(n,{iconName:qe(d,!0)}),p(n,i,s,!1,!!e)})).finally((()=>{o(n,{iconName:qe(s,!0)})})),Ye(n,e)})(n,i,s):void 0})};return{searchExternalPackages:e=>{$e(e)&&(i(!0),c(e))},clearExternalPackageSearch:()=>{r([...n.filter((e=>{var t;return!e.isExternal||e.isExternal&&(null==(t=s.get(e.id))?void 0:t.isSelected)})).sort(l)]),i(!1)},setExternalPackageIconState:(e,t,n)=>{if(!e)return;const r=a.packages.find((t=>t.id===e));var i;r&&o(e,{iconName:t?(i=r.registry,i===g.PackageRegistry.NPM?he.NPM_ERROR:he.JSR_ERROR):qe(r.registry,!0),iconTooltipText:n})},sortPackages:l,setExternalPackageRefreshState:p}};function nt({entityType:e}){const t=Ce().packageListStore,{searchExternalPackages:a}=at({entityType:e});return[t.packageRegistrySearchFilter,(e,n)=>{var r,i,s,o;const c=null!=(r=null==(i=Je(t.packageRegistrySearchFilter))?void 0:i.split(",").length)?r:0,l=null!=(s=null==(o=Je(e))?void 0:o.split(",").length)?s:0;n&&$e(n)&&c+1===l&&(t.setIsLoadingPackages(!0),a(n)),t.setPackageRegistrySearchFilter(e)}]}const rt=U()(J.Z).withConfig({displayName:"search-input__SearchInputContainer",componentId:"sc-1dqjg9a-0"})(["position:absolute;top:var(--spacing-zero);left:var(--spacing-zero);width:100%;z-index:1;& > div > div{box-shadow:unset !important;border:unset !important;border-radius:unset !important;border-bottom:var(--border-width-default) var(--border-style-solid) var(--border-color-default) !important;input{caret-color:var(--content-color-tertiary);}& > div{background:transparent;padding-right:var(--spacing-s);margin-left:var(--spacing-xs);}&:focus-within &:hover{border:unset !important;box-shadow:unset !important;}}"]),it=U()(J.Z).withConfig({displayName:"search-input__SearchFilter",componentId:"sc-1dqjg9a-1"})(["position:absolute;top:var(--spacing-xxl);z-index:1;padding:var(--spacing-s) var(--spacing-zero) var(--spacing-xs) var(--spacing-l);width:100%;background:var(--background-color-primary);"]),st=U()(V.Z).withConfig({displayName:"search-input__FilterButton",componentId:"sc-1dqjg9a-2"})(["background-color:transparent;border:var(--border-width-default) var(--border-style-solid) var(--border-color-default);",""],(({isSelected:e})=>e?"\n          background: var(--highlight-background-color-primary);\n          &,\n          &:hover {\n            border: var(--border-width-default) var(--border-style-solid) var(--content-color-secondary);\n          }\n\n          &:hover {\n            background: var(--highlight-background-color-tertiary);\n          }\n        ":"\n          &:hover {\n            background: var(--background-color-tertiary);\n            border: var(--border-width-default) var(--border-style-solid) var(--border-color-default);\n          }\n        ")),ot=(0,K.observer)((({isInternalPackagesFilterEnabled:e,isFilterEnabled:t,searchPlaceholder:a,searchText:n,onSearchTextChange:r,entityType:i})=>{const[s,c]=nt({entityType:i}),l=e=>{c(Object.assign({},s,{[e]:!s[e]}),n)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(rt,{children:(0,o.jsx)(Ke.Z,{autoFocus:!0,prefix:(0,o.jsx)(Ve.Z,{}),placeholder:a,value:n,onChange:e=>{r(e.target.value)}})}),t&&(0,o.jsxs)(it,{gap:"spacing-s",alignItems:"center",justifyContent:"flex-start",children:[e&&(0,o.jsx)(st,{isActive:s[g.PackageRegistry.POSTMAN],size:"small",isSelected:s[g.PackageRegistry.POSTMAN],onClick:()=>l(g.PackageRegistry.POSTMAN),text:(0,o.jsx)(H.ZP,{color:s[g.PackageRegistry.POSTMAN]?"content-color-primary":"content-color-secondary",type:"body-small",children:"Postman packages"}),type:"outline"}),(0,o.jsx)(st,{isActive:s[g.PackageRegistry.NPM],size:"small",isSelected:s[g.PackageRegistry.NPM],onClick:()=>l(g.PackageRegistry.NPM),text:(0,o.jsx)(H.ZP,{color:s[g.PackageRegistry.NPM]?"content-color-primary":"content-color-secondary",type:"body-small",children:"npm"}),type:"outline"}),(0,o.jsx)(st,{isActive:s[g.PackageRegistry.JSR],size:"small",isSelected:s[g.PackageRegistry.JSR],onClick:()=>l(g.PackageRegistry.JSR),text:(0,o.jsx)(H.ZP,{color:s[g.PackageRegistry.JSR]?"content-color-primary":"content-color-secondary",type:"body-small",children:"JSR"}),type:"outline"})]})]})}));function ct(){const e=Ce().editorToolbarStore;return[e.searchQuery,t=>e.setSearchQuery(t)]}const lt=U()(J.Z).withConfig({displayName:"selector__ListContainer",componentId:"sc-lrfmcq-0"})(["overflow:hidden;width:270px;padding:var(--spacing-xs) var(--spacing-s) var(--spacing-zero) var(--spacing-s);margin-top:",";margin-bottom:",";scrollbar-gutter:stable;"],(({isFilterEnabled:e})=>e?"70px":"var(--spacing-xxl)"),(({hasFooter:e})=>e?"var(--spacing-xxl)":"var(--spacing-xs)")),dt=U()(J.Z).withConfig({displayName:"selector__Container",componentId:"sc-lrfmcq-1"})(["position:relative;height:316px;&:hover ","{overflow-y:auto;}"],lt),gt=U()(J.Z).withConfig({displayName:"selector__FooterContainer",componentId:"sc-lrfmcq-2"})(["position:absolute;bottom:var(--spacing-xs);width:100%;padding:2px var(--spacing-zero);background-color:var(--background-color-primary);& > button{margin-top:var(--spacing-xs);padding-left:var(--spacing-l);}"]),pt=({options:e,footer:t,searchPlaceholder:a,noResultsText:r,searchBy:s,onSelect:c,onSearch:l,isLoading:d=!1,noOptionsComponent:g,isInternalPackagesEnabled:p=!1,isFilterEnabled:u=!1,shouldSkipSearch:h=(()=>!1),entityType:y})=>{const[m,k]=ct(),v=(0,n.useRef)([]),P=(0,n.useRef)(null),E=(0,n.useMemo)((()=>{const t=[],a=[];for(const n of e)h(n)?t.push(n):a.push(n);const n=((e,t,a=["name"])=>new(le())(t,a,{sort:!0}).search(e))(m,a,s);return!m&&P.current&&P.current.scrollTo({top:0}),[...n,...t]}),[m,e,h,s]);return(0,n.useEffect)((()=>{const e=e=>{const t=v.current.filter(Boolean);if(0===t.length)return;const a=t.indexOf(document.activeElement);if("ArrowDown"===e.key)if(e.preventDefault(),-1===a){var n;null==(n=t[0])||n.focus()}else{var r;null==(r=t[(a+1)%t.length])||r.focus()}else if("ArrowUp"===e.key)if(e.preventDefault(),-1===a){var i;null==(i=t[t.length-1])||i.focus()}else{var s;null==(s=t[(a-1+t.length)%t.length])||s.focus()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[E]),(0,n.useEffect)((()=>{const e=P.current;if(!e)return;const t=()=>{e.contains(document.activeElement)&&document.activeElement.blur()};return e.addEventListener("mouseenter",t),e.addEventListener("mousemove",t),()=>{e.removeEventListener("mouseenter",t),e.removeEventListener("mousemove",t)}}),[]),(0,o.jsxs)(dt,{children:[(0,o.jsx)(ot,{searchPlaceholder:a,searchText:m,onSearchTextChange:e=>{k(e),null==l||l(e)},isFilterEnabled:u,isInternalPackagesFilterEnabled:p,entityType:y}),(0,o.jsx)(lt,{ref:P,"data-testid":"script-toolbar-list",direction:"column",hasFooter:!!t,isFilterEnabled:u,children:d?(0,o.jsx)(J.Z,{height:"100%",width:"100%",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(i.Z,{})}):E.length>0?(0,o.jsx)(Ue,{options:E,onSelect:c,buttonRefs:v}):0===E.length&&!m&&g?(0,o.jsx)(o.Fragment,{children:g}):(0,o.jsx)(J.Z,{height:"100%",width:"100%",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(H.ZP,{type:"body-medium",color:"content-color-secondary",children:r})})}),t&&(0,o.jsxs)(gt,{alignItems:"flex-start",direction:"column",children:[(0,o.jsx)(de,{}),t]})]})};function ut(){const e=Ce().editorToolbarStore;return[e.activeToolbarAction,t=>e.setActiveToolbarAction(t)]}var ht=a(26663),yt=a.n(ht);const mt=U()(J.Z).withConfig({displayName:"package-error__Container",componentId:"sc-1e7d4l4-0"})(["margin-bottom:2px;"]),kt=()=>{(0,Q.openExternalLink)(yt().ARTEMIS_URL+"/settings/team/team-resources/external-packages")},vt=({message:e,buttonText:t})=>(0,o.jsxs)(mt,{width:"auto",gap:"spacing-xs",direction:"column",alignItems:"flex-start",children:[(0,o.jsx)(H.ZP,{type:"small",children:e}),(0,o.jsx)(V.Z,{text:(0,o.jsx)(H.ZP,{type:"small",children:t}),type:"monochrome-plain",onClick:kt})]});var Pt=function(e){return e.ENTRY_POINT_NOT_FOUND="ENTRY_POINT_NOT_FOUND",e.PACKAGE_JSON_NOT_FOUND="PACKAGE_JSON_NOT_FOUND",e.BUNDLING_FAILURE="BUNDLING_FAILURE",e.INSTALL_MEMORY_LIMIT_EXCEEDED="INSTALL_MEMORY_LIMIT_EXCEEDED",e.INSTALL_DISK_LIMIT_EXCEEDED="INSTALL_DISK_LIMIT_EXCEEDED",e.INSTALL_TIMEOUT="INSTALL_TIMEOUT",e.INSTALL_DISK_MONITOR_ERROR="INSTALL_DISK_MONITOR_ERROR",e.INSTALL_MEMORY_MONITOR_ERROR="INSTALL_MEMORY_MONITOR_ERROR",e.INSTALL_ERROR="INSTALL_ERROR",e.UNSUPPORTED_REGISTRY="UNSUPPORTED_REGISTRY",e.INVALID_PACKAGE_SCOPE="INVALID_PACKAGE_SCOPE",e.INVALID_PACKAGE_NAME="INVALID_PACKAGE_NAME",e.INVALID_PACKAGE_VERSION="INVALID_PACKAGE_VERSION",e.INVALID_FILENAME="INVALID_FILENAME",e.PACKAGE_DENIED="PACKAGE_DENIED",e.PACKAGE_NOT_FOUND="PACKAGE_NOT_FOUND",e.PACKAGE_VERSION_NOT_FOUND="PACKAGE_VERSION_NOT_FOUND",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",e.SANDBOX_UNSUPPORTED_PACKAGE="SANDBOX_UNSUPPORTED_PACKAGE",e.URI_TOO_LONG="URI_TOO_LONG",e.PACKAGE_ACCESS_DENIED="PACKAGE_ACCESS_DENIED",e.UNEXPECTED_APP_ERROR="UNEXPECTED_APP_ERROR",e}(Pt||{});const Et="Package not allowed. View allowed packages";function xt(e){if([Pt.ENTRY_POINT_NOT_FOUND,Pt.PACKAGE_JSON_NOT_FOUND,Pt.BUNDLING_FAILURE,Pt.INSTALL_ERROR,Pt.INSTALL_MEMORY_LIMIT_EXCEEDED,Pt.INSTALL_DISK_LIMIT_EXCEEDED,Pt.INSTALL_TIMEOUT,Pt.INSTALL_DISK_MONITOR_ERROR,Pt.INSTALL_MEMORY_MONITOR_ERROR,Pt.SANDBOX_UNSUPPORTED_PACKAGE,Pt.PACKAGE_DENIED].includes(e))return"This package cannot be used in Postman.";switch(e){case Pt.UNSUPPORTED_REGISTRY:return"The package registry is not supported.";case Pt.PACKAGE_NOT_FOUND:return"Couldn't find the package.";case Pt.RATE_LIMIT_EXCEEDED:return"Package usage limit reached. Contact Postman support.";case Pt.INVALID_PACKAGE_SCOPE:return"Package scope invalid.";case Pt.INVALID_PACKAGE_NAME:case Pt.URI_TOO_LONG:return"Package name invalid.";case Pt.INVALID_PACKAGE_VERSION:case Pt.PACKAGE_VERSION_NOT_FOUND:return"Package version invalid.";case Pt.INVALID_FILENAME:return"Package filename invalid.";case Pt.PACKAGE_ACCESS_DENIED:return Et;case Pt.UNEXPECTED_ERROR:case Pt.UNEXPECTED_APP_ERROR:default:return"Something went wrong. Try again."}}function ft(e){return e===Et?(0,o.jsx)(vt,{message:"Package access not allowed.",buttonText:"View allowed packages"}):e}const bt=(0,K.observer)((({handleAddPackages:e,selectedPackages:t,mode:a,entityType:r})=>{const i=(0,Y.useActiveWorkspaceId)(),s=(0,Q.useNavigate)(),{data:c,isLoading:l}=(0,g.usePackagesWithGlobalName)(),[,p]=ut(),[u]=nt({entityType:r}),[h]=ct(),{packages:y,isLoadingPackages:m,setIsLoadingPackages:k,packagesState:v}=je(),{isEnabled:P}=(0,g.useIsPackageEnabled)(),{isEnabled:E}=(0,g.useIsExternalPackageEnabled)(),{fetchPackages:x,selectPackage:b,onPackageSearch:_}=(({entityType:e})=>{const t=(0,Y.useActiveWorkspaceId)(),a=(0,Q.useNavigate)(),[,n]=ut(),[r]=nt({entityType:e}),{packages:i,setPackages:s,setIsLoadingPackages:o,updatePackageState:c,clearPackageState:l}=je(),{searchExternalPackages:d,clearExternalPackageSearch:p,setExternalPackageIconState:u,sortPackages:h,setExternalPackageRefreshState:y}=at({entityType:e}),m=(r,i,s)=>{if(!s)return{postmanPackages:[],externalPackageIds:i};const o=[...i];return{postmanPackages:r.map((r=>{const s=i.includes(r.id);return s&&o.splice(o.indexOf(r.id),1),c(r.id,{iconName:qe(g.PackageRegistry.POSTMAN,s),isSelected:s}),{id:r.id,name:r.name,globalName:r.globalName,description:r.description,registry:g.PackageRegistry.POSTMAN,showDescription:!0,openItem:i=>{n(null),Qe(g.PackageRegistry.POSTMAN,r.name,r.id,e),a(`/workspace/${t}/package-library/${i}`,{},{customNavEvent:"COLLECTION_RUNNER_NAV_EVENT"})},isSelected:s,iconName:qe(g.PackageRegistry.POSTMAN,s)}})),externalPackageIds:o}};return{fetchPackages:async(e,t,a,n)=>{l();const{postmanPackages:r,externalPackageIds:d}=m(e,t,a);if(!n||0===d.length)return s(r);const g=await O(),p=d.map((e=>((e,t)=>{var a;const n=t[e]||e,r=n?S(n):null;if(!r)return null;const{packageRegistry:s,packageIdentifier:o}=r;if(!s||!o)return null;const{name:l,version:d}=f(o);c(e,{iconName:Be(s),iconTooltipText:void 0,isSelected:!0}),y(e,n,s,!0),j(e,!1).then((t=>{if(null!=t&&t.error)u(e,!0,ft(xt(t.error)));else if(null!=t&&t.packageId){u(e);const{version:a}=f(t.packageId);a&&c(e,{version:a}),y(e,n,s,!1,!(null==t||!t.error))}}));const g=(null==(a=i.find((t=>t.id===e)))?void 0:a.description)||"";return{id:e,name:l,globalName:n,version:d,description:g,showDescription:!0,registry:s,openItem:()=>{const e=R(o),t=M({registry:s,name:e,version:d||""});(0,Q.openExternalLink)(t)},openItemTooltipText:L(s),isSelected:!0,isExternal:!0,iconName:Be(s)}})(e,g))),k=p.filter((e=>null!==e));0===k.length&&l();const v=[...k,...r].sort(h);s(v),o(!1)},fetchPostmanPackages:m,selectPackage:async e=>{const t=i.find((t=>t.id===e));if(!t)return;if(c(e,{iconName:t.registry===g.PackageRegistry.POSTMAN?qe(g.PackageRegistry.POSTMAN,!0):Be(t.registry),isSelected:!0,iconTooltipText:void 0}),!t.isExternal)return;y(e,t.globalName,t.registry,!0);const a=await j(t.globalName,!1);null!=a&&a.error?u(e,!0,ft(xt(a.error))):null!=a&&a.packageId&&u(e),y(e,t.globalName,t.registry,!1,!(null==a||!a.error))},onPackageSearch:(e,t)=>{t&&(e?Je(r)&&d(e):p())}}})({entityType:r}),N=Object.values(t).map((e=>e.id)),A=(0,n.useMemo)((()=>!!h&&!!(u[g.PackageRegistry.JSR]||u[g.PackageRegistry.NPM]||u[g.PackageRegistry.POSTMAN]||h)),[h,u]),I=(0,d.useDebouncedCallback)((e=>{We(u,a,e,r)}),800);(0,n.useEffect)((()=>{l&&k(!0),c&&!l&&x(c,N,P,E)}),[c,l,N.join(",")]);const T=(0,n.useMemo)((()=>A?function(e,t){const a=[];return t[g.PackageRegistry.POSTMAN]&&a.push(g.PackageRegistry.POSTMAN),t[g.PackageRegistry.NPM]&&a.push(g.PackageRegistry.NPM),t[g.PackageRegistry.JSR]&&a.push(g.PackageRegistry.JSR),0===a.length||3===a.length?e:e.filter((e=>a.includes(e.registry)))}(y,u):y),[u,y,A]);return(0,o.jsx)(pt,{searchPlaceholder:P&&E?"Search Postman, NPM, and JSR":E?"Search NPM and JSR":"Search packages",isFilterEnabled:A&&E,isInternalPackagesEnabled:P,options:T,onSelect:t=>{He(t,r),b(t.id),e(t.name,t.globalName)},onSearch:e=>{_(e,E),I(e)},isLoading:m,noOptionsComponent:(0,o.jsx)(oe,{isExternalPackagesEnabled:E,isPostmanPackagesEnabled:P}),searchBy:["name","description","globalName"],noResultsText:"No package found",shouldSkipSearch:e=>{var t;return!(null!=(t=v.get(e.id))&&t.isSelected||!e.isExternal)},entityType:r,footer:P?(0,o.jsx)(V.Z,{size:"small",type:"plain",text:"Open package library",onClick:()=>{W.AnalyticsService.addEventV2({category:"package_library",action:"open_package_library",variantId:"ide"}),s(`/workspace/${i}/package-library`,{},{customNavEvent:"VIEW_COLLECTION_FOLDER_REQUEST"}),p(null)}}):void 0})})),_t=U()(V.Z).withConfig({displayName:"editor-toolbar__PackageButton",componentId:"sc-1ylzx21-0"})(["& i{margin-right:",";}"],(({isScriptWidthNarrow:e})=>e?"0":"6px")),St=U()(V.Z).withConfig({displayName:"editor-toolbar__PrettifyButton",componentId:"sc-1ylzx21-1"})(["width:var(--size-s);height:var(--size-s);"]),Nt=U()(J.Z).withConfig({displayName:"editor-toolbar__ToolbarContainer",componentId:"sc-1ylzx21-2"})(["height:var(--size-m);width:auto;gap:var(--spacing-xs);padding:var(--spacing-xs);margin-right:var(--spacing-m);border-radius:var(--border-radius-l);position:absolute;bottom:var(--spacing-s);right:22px;border:var(--border-width-default) var(--border-style-solid) var(--border-color-default);background-color:var(--background-color-primary);z-index:1;"]),Rt=U()($.ZP).withConfig({displayName:"editor-toolbar__StyledPopover",componentId:"sc-1ylzx21-3"})([".tippy-content{margin-bottom:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-zero) var(--spacing-zero);background-color:var(--background-color-primary);}"]),At=(0,K.observer)((({snippets:e,isPackageLibraryEnabled:t,handleSnippetSelect:a,selectedPackages:r,mode:i,handleAddPackages:s,isScriptWidthNarrow:c,handleBeautifyContent:l,entityType:d})=>{const[g,p]=ut(),u=(0,n.useRef)(null),h=(0,n.useRef)(null),[,y]=ct(),{clearExternalPackageSearch:m}=at({entityType:d}),k=(0,n.useMemo)((()=>e.map((e=>Object.assign({},e,{name:e.name,description:e.description,category:e.category})))),[e]),v=e=>{p(e===g?null:e)};return(0,o.jsxs)(Nt,{alignItems:"center",justifyContent:"center",children:[(0,o.jsxs)(J.Z,{gap:"spacing-xs",children:[t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_t,{ref:u,"data-testid":"script-toolbar-packages-button",size:"small",type:"tertiary",isActive:g===ye.Packages,onClick:()=>v(ye.Packages),icon:(0,o.jsx)(q.Z,{}),tooltip:c?(0,o.jsx)(z.Z,{openDelay:1e3,content:"Packages"}):void 0,isScriptWidthNarrow:c,text:c?void 0:"Packages"}),g===ye.Packages&&(0,o.jsx)(Rt,{isOpen:g===ye.Packages,triggerRef:u,placement:"top-end",onClickOutside:()=>{p(null),y(""),m()},children:(0,o.jsx)(bt,{handleAddPackages:s,selectedPackages:r,mode:i,entityType:d})})]}),(0,o.jsx)(V.Z,{ref:h,"data-testid":"script-toolbar-snippets-button",size:"small",type:"tertiary",onClick:()=>v(ye.Snippets),icon:(0,o.jsx)(B.Z,{}),text:c?void 0:"Snippets",isActive:g===ye.Snippets,tooltip:c?(0,o.jsx)(z.Z,{openDelay:1e3,content:"Snippets"}):void 0}),g===ye.Snippets&&(0,o.jsx)(Rt,{isOpen:g===ye.Snippets,triggerRef:h,triggerEvent:"click",placement:"top-end",onClickOutside:()=>p(null),children:(0,o.jsx)(pt,{searchPlaceholder:"Search snippets",options:k,onSelect:e=>{i&&W.AnalyticsService.addEventV2({category:`${i}-script-snippets`,action:"click",label:e.name}),a(e)},searchBy:["name","category"],noResultsText:"No snippet found",entityType:d})})]}),(0,o.jsx)(de,{isVertical:!0}),(0,o.jsx)(St,{"data-testid":"script-toolbar-beautify-button",tooltip:(0,o.jsx)(z.Z,{openDelay:1e3,content:"Beautify"}),size:"small",type:"tertiary",onClick:l,shortcutLabel:"âŒ˜ + B",icon:(0,o.jsx)(X.Z,{})})]})})),It=e=>(0,o.jsx)(Te,{children:(0,o.jsx)(At,Object.assign({},e))})}}]);
//# sourceMappingURL=744.800440f8e1b6a7db.js.map