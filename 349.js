"use strict";var I=Object.defineProperty;var B=(w,d,y)=>d in w?I(w,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):w[d]=y;var x=(w,d,y)=>(B(w,typeof d!="symbol"?d+"":d,y),y);exports.id=349,exports.ids=[349],exports.modules={852730:(w,d,y)=>{y.d(d,{EventStreamSerde:()=>k});var T=y(399163),C=y(425294);class k{constructor({marshaller:a,serializer:i,deserializer:o,serdeContext:m,defaultContentType:u}){x(this,"marshaller");x(this,"serializer");x(this,"deserializer");x(this,"serdeContext");x(this,"defaultContentType");this.marshaller=a,this.serializer=i,this.deserializer=o,this.serdeContext=m,this.defaultContentType=u}async serializeEventStream({eventStream:a,requestSchema:i,initialRequest:o}){const m=this.marshaller,u=i.getEventStreamMember(),v=i.getMemberSchema(u),h=this.serializer,S=this.defaultContentType,p=Symbol("initialRequestMarker"),b={async*[Symbol.asyncIterator](){if(o){const r={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:S}};h.write(i,o);const t=h.flush();yield{[p]:!0,headers:r,body:t}}for await(const r of a)yield r}};return m.serialize(b,r=>{if(r[p])return{headers:r.headers,body:r.body};const t=Object.keys(r).find(s=>s!=="__type")??"",{additionalHeaders:e,body:n,eventType:l,explicitPayloadContentType:c}=this.writeEventBody(t,v,r);return{headers:{":event-type":{type:"string",value:l},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:c??S},...e},body:n}})}async deserializeEventStream({response:a,responseSchema:i,initialResponseContainer:o}){const m=this.marshaller,u=i.getEventStreamMember(),h=i.getMemberSchema(u).getMemberSchemas(),S=Symbol("initialResponseMarker"),p=m.deserialize(a.body,async t=>{const e=Object.keys(t).find(l=>l!=="__type")??"",n=t[e].body;if(e==="initial-response"){const l=await this.deserializer.read(i,n);return delete l[u],{[S]:!0,...l}}else if(e in h){const l=h[e];if(l.isStructSchema()){const c={};let f=!1;for(const[s,z]of l.structIterator()){const{eventHeader:E,eventPayload:M}=z.getMergedTraits();if(f=f||Boolean(E||M),M)z.isBlobSchema()?c[s]=n:z.isStringSchema()?c[s]=(this.serdeContext?.utf8Encoder??T.P)(n):z.isStructSchema()&&(c[s]=await this.deserializer.read(z,n));else if(E){const g=t[e].headers[s]?.value;g!=null&&(z.isNumericSchema()?g&&typeof g=="object"&&"bytes"in g?c[s]=BigInt(g.toString()):c[s]=Number(g):c[s]=g)}}if(f)return{[e]:c}}return{[e]:await this.deserializer.read(l,n)}}else return{$unknown:t}}),b=p[Symbol.asyncIterator](),r=await b.next();if(r.done)return p;if(r.value?.[S]){if(!i)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(const[t,e]of Object.entries(r.value))o[t]=e}return{async*[Symbol.asyncIterator](){for(r?.value?.[S]||(yield r.value);;){const{done:t,value:e}=await b.next();if(t)break;yield e}}}}writeEventBody(a,i,o){const m=this.serializer;let u=a,v=null,h;const S=(()=>i.getSchema()[4].includes(a))(),p={};if(S){const t=i.getMemberSchema(a);if(t.isStructSchema()){for(const[e,n]of t.structIterator()){const{eventHeader:l,eventPayload:c}=n.getMergedTraits();if(c){v=e;break}else if(l){const f=o[a][e];let s="binary";n.isNumericSchema()?(-2)**31<=f&&f<=2**31-1?s="integer":s="long":n.isTimestampSchema()?s="timestamp":n.isStringSchema()?s="string":n.isBooleanSchema()&&(s="boolean"),f!=null&&(p[e]={type:s,value:f},delete o[a][e])}}if(v!==null){const e=t.getMemberSchema(v);e.isBlobSchema()?h="application/octet-stream":e.isStringSchema()&&(h="text/plain"),m.write(e,o[a][v])}else m.write(t,o[a])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{const[t,e]=o[a];u=t,m.write(15,e)}const b=m.flush();return{body:typeof b=="string"?(this.serdeContext?.utf8Decoder??C.a)(b):b,eventType:u,explicitPayloadContentType:h,additionalHeaders:p}}}}};
