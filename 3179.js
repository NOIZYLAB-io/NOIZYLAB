"use strict";var de=Object.defineProperty;var fe=(P,d,n)=>d in P?de(P,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):P[d]=n;var C=(P,d,n)=>(fe(P,typeof d!="symbol"?d+"":d,n),n);exports.id=3179,exports.ids=[3179],exports.modules={93179:(P,d,n)=>{n.d(d,{fromIni:()=>le});var l=n(336937),g=n(347874),y=n(966653),r=n(313421),a=n(200309);const h=(t,s,e)=>{const o={EcsContainer:async i=>{const{fromHttp:c}=await n.e(8639).then(n.bind(n,418639)),{fromContainerMetadata:u}=await n.e(4390).then(n.bind(n,924390));return e?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>(0,a.c)(c(i??{}),u(i))().then(I)},Ec2InstanceMetadata:async i=>{e?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");const{fromInstanceMetadata:c}=await n.e(4390).then(n.bind(n,924390));return async()=>c(i)().then(I)},Environment:async i=>{e?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");const{fromEnv:c}=await n.e(7116).then(n.bind(n,497116));return async()=>c(i)().then(I)}};if(t in o)return o[t];throw new y.C(`Unsupported credential source in profile ${s}. Got ${t}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:e})},I=t=>(0,r.g)(t,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),D=(t,{profile:s="default",logger:e}={})=>Boolean(t)&&typeof t=="object"&&typeof t.role_arn=="string"&&["undefined","string"].indexOf(typeof t.role_session_name)>-1&&["undefined","string"].indexOf(typeof t.external_id)>-1&&["undefined","string"].indexOf(typeof t.mfa_serial)>-1&&(V(t,{profile:s,logger:e})||Y(t,{profile:s,logger:e})),V=(t,{profile:s,logger:e})=>{const o=typeof t.source_profile=="string"&&typeof t.credential_source>"u";return o&&e?.debug?.(`    ${s} isAssumeRoleWithSourceProfile source_profile=${t.source_profile}`),o},Y=(t,{profile:s,logger:e})=>{const o=typeof t.credential_source=="string"&&typeof t.source_profile>"u";return o&&e?.debug?.(`    ${s} isCredentialSourceProfile credential_source=${t.credential_source}`),o},z=async(t,s,e,o={},i)=>{e.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");const c=s[t],{source_profile:u,region:A}=c;if(!e.roleAssumer){const{getDefaultRoleAssumer:T}=await n.e(9909).then(n.bind(n,529909));e.roleAssumer=T({...e.clientConfig,credentialProviderLogger:e.logger,parentClientConfig:{...e?.parentClientConfig,region:A??e?.parentClientConfig?.region}},e.clientPlugins)}if(u&&u in o)throw new y.C(`Detected a cycle attempting to resolve credentials for profile ${(0,g.Bz)(e)}. Profiles visited: `+Object.keys(o).join(", "),{logger:e.logger});e.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${u?`source_profile=[${u}]`:`profile=[${t}]`}`);const k=u?i(u,s,e,{...o,[u]:!0},H(s[u]??{})):(await h(c.credential_source,t,e.logger)(e))();if(H(c))return k.then(T=>(0,r.g)(T,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{const T={RoleArn:c.role_arn,RoleSessionName:c.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:c.external_id,DurationSeconds:parseInt(c.duration_seconds||"3600",10)},{mfa_serial:b}=c;if(b){if(!e.mfaCodeProvider)throw new y.C(`Profile ${t} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:e.logger,tryNextLink:!1});T.SerialNumber=b,T.TokenCode=await e.mfaCodeProvider(b)}const O=await k;return e.roleAssumer(O,T).then(N=>(0,r.g)(N,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},H=t=>!t.role_arn&&!!t.credential_source;var J=n(404317),F=n(66221),M=n(650600);const W=(...t)=>{const s={};for(const e of t)for(const[o,i]of Object.entries(e))s[o]!==void 0?Object.assign(s[o],i):s[o]=i;return s},U=async t=>{const s=await(0,M.p)(t);return W(s.configFile,s.credentialsFile)};var X=n(450610),p=n(631263),m=n(390846),f=n(977598),E=n(973024),v=n(848161),S=n(176760);const Z=class{constructor(s,e,o){C(this,"profileData");C(this,"init");C(this,"callerClientConfig");this.profileData=s,this.init=e,this.callerClientConfig=o}async loadCredentials(){const s=await this.loadToken();if(!s)throw new F.C(`Failed to load a token for session ${this.loginSession}, please re-authenticate using aws login`,{tryNextLink:!1,logger:this.logger});const e=s.accessToken,o=Date.now();return new Date(e.expiresAt).getTime()-o<=Z.REFRESH_THRESHOLD?this.refresh(s):{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey,sessionToken:e.sessionToken,accountId:e.accountId,expiration:new Date(e.expiresAt)}}get logger(){return this.init?.logger}get loginSession(){return this.profileData.login_session}async refresh(s){const{SigninClient:e,CreateOAuth2TokenCommand:o}=await n.e(2737).then(n.bind(n,872737)),{logger:i,userAgentAppId:c}=this.callerClientConfig??{},A=(O=>O?.metadata?.handlerProtocol==="h2")(this.callerClientConfig?.requestHandler)?void 0:this.callerClientConfig?.requestHandler,k=this.profileData.region??await this.callerClientConfig?.region?.()??process.env.AWS_REGION,T=new e({credentials:{accessKeyId:"",secretAccessKey:""},region:k,requestHandler:A,logger:i,userAgentAppId:c,...this.init?.clientConfig});this.createDPoPInterceptor(T.middlewareStack);const b={tokenInput:{clientId:s.clientId,refreshToken:s.refreshToken,grantType:"refresh_token"}};try{const O=await T.send(new o(b)),{accessKeyId:N,secretAccessKey:R,sessionToken:B}=O.tokenOutput?.accessToken??{},{refreshToken:G,expiresIn:ne}=O.tokenOutput??{};if(!N||!R||!B||!G)throw new F.C("Token refresh response missing required fields",{logger:this.logger,tryNextLink:!1});const _=(ne??900)*1e3,K=new Date(Date.now()+_),se={...s,accessToken:{...s.accessToken,accessKeyId:N,secretAccessKey:R,sessionToken:B,expiresAt:K.toISOString()},refreshToken:G};await this.saveToken(se);const Q=se.accessToken;return{accessKeyId:Q.accessKeyId,secretAccessKey:Q.secretAccessKey,sessionToken:Q.sessionToken,accountId:Q.accountId,expiration:K}}catch(O){if(O.name==="AccessDeniedException"){const N=O.error;let R;switch(N){case"TOKEN_EXPIRED":R="Your session has expired. Please reauthenticate.";break;case"USER_CREDENTIALS_CHANGED":R="Unable to refresh credentials because of a change in your password. Please reauthenticate with your new password.";break;case"INSUFFICIENT_PERMISSIONS":R="Unable to refresh credentials due to insufficient permissions. You may be missing permission for the 'CreateOAuth2Token' action.";break;default:R=`Failed to refresh token: ${String(O)}. Please re-authenticate using \`aws login\``}throw new F.C(R,{logger:this.logger,tryNextLink:!1})}throw new F.C(`Failed to refresh token: ${String(O)}. Please re-authenticate using aws login`,{logger:this.logger})}}async loadToken(){const s=this.getTokenFilePath();try{let e;try{e=await(0,m.TA)(s,{ignoreCache:this.init?.ignoreCache})}catch{e=await E.promises.readFile(s,"utf8")}const o=JSON.parse(e),i=["accessToken","clientId","refreshToken","dpopKey"].filter(c=>!o[c]);if(o.accessToken?.accountId||i.push("accountId"),i.length>0)throw new F.C(`Token validation failed, missing fields: ${i.join(", ")}`,{logger:this.logger,tryNextLink:!1});return o}catch(e){throw new F.C(`Failed to load token from ${s}: ${String(e)}`,{logger:this.logger,tryNextLink:!1})}}async saveToken(s){const e=this.getTokenFilePath(),o=(0,S.dirname)(e);try{await E.promises.mkdir(o,{recursive:!0})}catch{}await E.promises.writeFile(e,JSON.stringify(s,null,2),"utf8")}getTokenFilePath(){const s=process.env.AWS_LOGIN_CACHE_DIRECTORY??(0,S.join)((0,v.homedir)(),".aws","login","cache"),e=Buffer.from(this.loginSession,"utf8"),o=(0,f.createHash)("sha256").update(e).digest("hex");return(0,S.join)(s,`${o}.json`)}derToRawSignature(s){let e=2;if(s[e]!==2)throw new Error("Invalid DER signature");e++;const o=s[e++];let i=s.subarray(e,e+o);if(e+=o,s[e]!==2)throw new Error("Invalid DER signature");e++;const c=s[e++];let u=s.subarray(e,e+c);i=i[0]===0?i.subarray(1):i,u=u[0]===0?u.subarray(1):u;const A=Buffer.concat([Buffer.alloc(32-i.length),i]),k=Buffer.concat([Buffer.alloc(32-u.length),u]);return Buffer.concat([A,k])}createDPoPInterceptor(s){s.add(e=>async o=>{if(p.K.isInstance(o.request)){const i=o.request,c=`${i.protocol}//${i.hostname}${i.port?`:${i.port}`:""}${i.path}`,u=await this.generateDpop(i.method,c);i.headers={...i.headers,DPoP:u}}return e(o)},{step:"finalizeRequest",name:"dpopInterceptor",override:!0})}async generateDpop(s="POST",e){const o=await this.loadToken();try{const i=(0,f.createPrivateKey)({key:o.dpopKey,format:"pem",type:"sec1"}),u=(0,f.createPublicKey)(i).export({format:"der",type:"spki"});let A=-1;for(let K=0;K<u.length;K++)if(u[K]===4){A=K;break}const k=u.slice(A+1,A+33),T=u.slice(A+33,A+65),b={alg:"ES256",typ:"dpop+jwt",jwk:{kty:"EC",crv:"P-256",x:k.toString("base64url"),y:T.toString("base64url")}},O={jti:crypto.randomUUID(),htm:s,htu:e,iat:Math.floor(Date.now()/1e3)},N=Buffer.from(JSON.stringify(b)).toString("base64url"),R=Buffer.from(JSON.stringify(O)).toString("base64url"),B=`${N}.${R}`,G=(0,f.sign)("sha256",Buffer.from(B),i),_=this.derToRawSignature(G).toString("base64url");return`${B}.${_}`}catch(i){throw new F.C(`Failed to generate Dpop proof: ${i instanceof Error?i.message:String(i)}`,{logger:this.logger,tryNextLink:!1})}}};let x=Z;C(x,"REFRESH_THRESHOLD",5*60*1e3);const w=t=>async({callerClientConfig:s}={})=>{t?.logger?.debug?.("@aws-sdk/credential-providers - fromLoginCredentials");const e=await U(t||{}),o=(0,X.Bz)({profile:t?.profile??s?.profile}),i=e[o];if(!i?.login_session)throw new F.C(`Profile ${o} does not contain login_session.`,{tryNextLink:!0,logger:t?.logger});const u=await new x(i,t,s).loadCredentials();return(0,J.g)(u,"CREDENTIALS_LOGIN","AD")},L=t=>Boolean(t&&t.login_session),$=async(t,s)=>{const e=await w({...s,profile:t})();return(0,r.g)(e,"CREDENTIALS_PROFILE_LOGIN","AC")},j=t=>Boolean(t)&&typeof t=="object"&&typeof t.credential_process=="string",re=async(t,s)=>n.e(7369).then(n.bind(n,739750)).then(({fromProcess:e})=>e({...t,profile:s})().then(o=>(0,r.g)(o,"CREDENTIALS_PROFILE_PROCESS","v"))),oe=async(t,s,e={})=>{const{fromSSO:o}=await n.e(9501).then(n.bind(n,21882));return o({profile:t,logger:e.logger,parentClientConfig:e.parentClientConfig,clientConfig:e.clientConfig})().then(i=>s.sso_session?(0,r.g)(i,"CREDENTIALS_PROFILE_SSO","r"):(0,r.g)(i,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))},ie=t=>t&&(typeof t.sso_start_url=="string"||typeof t.sso_account_id=="string"||typeof t.sso_session=="string"||typeof t.sso_region=="string"||typeof t.sso_role_name=="string"),q=t=>Boolean(t)&&typeof t=="object"&&typeof t.aws_access_key_id=="string"&&typeof t.aws_secret_access_key=="string"&&["undefined","string"].indexOf(typeof t.aws_session_token)>-1&&["undefined","string"].indexOf(typeof t.aws_account_id)>-1,ee=async(t,s)=>{s?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");const e={accessKeyId:t.aws_access_key_id,secretAccessKey:t.aws_secret_access_key,sessionToken:t.aws_session_token,...t.aws_credential_scope&&{credentialScope:t.aws_credential_scope},...t.aws_account_id&&{accountId:t.aws_account_id}};return(0,r.g)(e,"CREDENTIALS_PROFILE","n")},ae=t=>Boolean(t)&&typeof t=="object"&&typeof t.web_identity_token_file=="string"&&typeof t.role_arn=="string"&&["undefined","string"].indexOf(typeof t.role_session_name)>-1,ce=async(t,s)=>n.e(5982).then(n.bind(n,995982)).then(({fromTokenFile:e})=>e({webIdentityTokenFile:t.web_identity_token_file,roleArn:t.role_arn,roleSessionName:t.role_session_name,roleAssumerWithWebIdentity:s.roleAssumerWithWebIdentity,logger:s.logger,parentClientConfig:s.parentClientConfig})().then(o=>(0,r.g)(o,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))),te=async(t,s,e,o={},i=!1)=>{const c=s[t];if(Object.keys(o).length>0&&q(c))return ee(c,e);if(i||D(c,{profile:t,logger:e.logger}))return z(t,s,e,o,te);if(q(c))return ee(c,e);if(ae(c))return ce(c,e);if(j(c))return re(e,t);if(ie(c))return await oe(t,c,e);if(L(c))return $(t,e);throw new y.C(`Could not resolve credentials using profile: [${t}] in configuration/credentials file(s).`,{logger:e.logger})},le=(t={})=>async({callerClientConfig:s}={})=>{const e={...t,parentClientConfig:{...s,...t.parentClientConfig}};e.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");const o=await(0,l.Y)(e);return te((0,g.Bz)({profile:t.profile??s?.profile}),o,e)}},336937:(P,d,n)=>{n.d(d,{Y:()=>y});var l=n(201933);const g=(...r)=>{const a={};for(const h of r)for(const[I,D]of Object.entries(h))a[I]!==void 0?Object.assign(a[I],D):a[I]=D;return a},y=async r=>{const a=await(0,l.p)(r);return g(a.configFile,a.credentialsFile)}},404317:(P,d,n)=>{n.d(d,{g:()=>l});function l(g,y,r){return g.$source||(g.$source={}),g.$source[y]=r,g}},66221:(P,d,n)=>{n.d(d,{C:()=>g});var l=n(201745);class g extends l.m{constructor(a,h=!0){super(a,h);C(this,"name","CredentialsProviderError");Object.setPrototypeOf(this,g.prototype)}}},201745:(P,d,n)=>{n.d(d,{m:()=>l});class l extends Error{constructor(r,a=!0){let h,I=!0;typeof a=="boolean"?(h=void 0,I=a):a!=null&&typeof a=="object"&&(h=a.logger,I=a.tryNextLink??!0);super(r);C(this,"name","ProviderError");C(this,"tryNextLink");this.tryNextLink=I,Object.setPrototypeOf(this,l.prototype),h?.debug?.(`@smithy/property-provider ${I?"->":"(!)"} ${r}`)}static from(r,a=!0){return Object.assign(new this(r.message,a),r)}}},631263:(P,d,n)=>{n.d(d,{K:()=>l});class l{constructor(r){C(this,"method");C(this,"protocol");C(this,"hostname");C(this,"port");C(this,"path");C(this,"query");C(this,"headers");C(this,"username");C(this,"password");C(this,"fragment");C(this,"body");this.method=r.method||"GET",this.hostname=r.hostname||"localhost",this.port=r.port,this.query=r.query||{},this.headers=r.headers||{},this.body=r.body,this.protocol=r.protocol?r.protocol.slice(-1)!==":"?`${r.protocol}:`:r.protocol:"https:",this.path=r.path?r.path.charAt(0)!=="/"?`/${r.path}`:r.path:"/",this.username=r.username,this.password=r.password,this.fragment=r.fragment}static clone(r){const a=new l({...r,headers:{...r.headers}});return a.query&&(a.query=g(a.query)),a}static isInstance(r){if(!r)return!1;const a=r;return"method"in a&&"protocol"in a&&"hostname"in a&&"path"in a&&typeof a.query=="object"&&typeof a.headers=="object"}clone(){return l.clone(this)}}function g(y){return Object.keys(y).reduce((r,a)=>{const h=y[a];return{...r,[a]:Array.isArray(h)?[...h]:h}},{})}},646847:(P,d,n)=>{n.d(d,{Q:()=>l});const l="."},450610:(P,d,n)=>{n.d(d,{Bz:()=>y});const l="AWS_PROFILE",g="default",y=r=>r.profile||process.env[l]||g},650600:(P,d,n)=>{n.d(d,{p:()=>X});var l=n(16928),g;(function(p){p.PROFILE="profile",p.SSO_SESSION="sso-session",p.SERVICES="services"})(g||(g={}));var y=n(646847);const r=p=>Object.entries(p).filter(([m])=>{const f=m.indexOf(y.Q);return f===-1?!1:Object.values(g).includes(m.substring(0,f))}).reduce((m,[f,E])=>{const v=f.indexOf(y.Q),S=f.substring(0,v)===g.PROFILE?f.substring(v+1):f;return m[S]=E,m},{...p.default&&{default:p.default}});var a=n(370857);const h={},I=()=>process&&process.geteuid?`${process.geteuid()}`:"DEFAULT",D=()=>{const{HOME:p,USERPROFILE:m,HOMEPATH:f,HOMEDRIVE:E=`C:${l.sep}`}=process.env;if(p)return p;if(m)return m;if(f)return`${E}${f}`;const v=I();return h[v]||(h[v]=(0,a.homedir)()),h[v]},V="AWS_CONFIG_FILE",Y=()=>process.env[V]||(0,l.join)(D(),".aws","config"),z="AWS_SHARED_CREDENTIALS_FILE",H=()=>process.env[z]||(0,l.join)(D(),".aws","credentials"),J=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,F=["__proto__","profile __proto__"],M=p=>{const m={};let f,E;for(const v of p.split(/\r?\n/)){const S=v.split(/(^|\s)[;#]/)[0].trim();if(S[0]==="["&&S[S.length-1]==="]"){f=void 0,E=void 0;const w=S.substring(1,S.length-1),L=J.exec(w);if(L){const[,$,,j]=L;Object.values(g).includes($)&&(f=[$,j].join(y.Q))}else f=w;if(F.includes(w))throw new Error(`Found invalid profile name "${w}"`)}else if(f){const w=S.indexOf("=");if(![0,-1].includes(w)){const[L,$]=[S.substring(0,w).trim(),S.substring(w+1).trim()];if($==="")E=L;else{E&&v.trimStart()===v&&(E=void 0),m[f]=m[f]||{};const j=E?[E,L].join(y.Q):L;m[f][j]=$}}}}return m};var W=n(390846);const U=()=>({}),X=async(p={})=>{const{filepath:m=H(),configFilepath:f=Y()}=p,E=D(),v="~/";let S=m;m.startsWith(v)&&(S=(0,l.join)(E,m.slice(2)));let x=f;f.startsWith(v)&&(x=(0,l.join)(E,f.slice(2)));const w=await Promise.all([(0,W.TA)(x,{ignoreCache:p.ignoreCache}).then(M).then(r).catch(U),(0,W.TA)(S,{ignoreCache:p.ignoreCache}).then(M).catch(U)]);return{configFile:w[0],credentialsFile:w[1]}}},390846:(P,d,n)=>{n.d(d,{TA:()=>a});var l=n(51455),g=n.n(l);const y={},r={},a=(h,I)=>r[h]!==void 0?r[h]:((!y[h]||I?.ignoreCache)&&(y[h]=(0,l.readFile)(h,"utf8")),y[h])}};
