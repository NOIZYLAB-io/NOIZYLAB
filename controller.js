"use strict";const PLAY_ICON='<i class="codicon codicon-play"></i>',PAUSE_ICON='<i class="codicon codicon-debug-pause"></i>',REFRESH_ICON='<i class="codicon codicon-refresh"></i>';(()=>{const e=acquireVsCodeApi(),n=document.getElementById("canvas"),t=n.getContext("2d");n.height=512;const a=document.getElementById("susresBtn"),o=document.getElementById("backBtn"),s=document.getElementById("forwardBtn"),i=document.getElementById("duration"),c=document.getElementById("label"),d=document.getElementById("seekbar");let r,l,u,y;window.addEventListener("message",(f=>{r&&(r.close(),i.innerHTML="",cancelAnimationFrame(l),clearTimeout(u)),y=f.data.rgbColor,r=function(r){n.width=window.innerWidth-10;const f=n.width;O("LOADING");const m=new AudioContext,p=m.createAnalyser();p.smoothingTimeConstant=0,p.fftSize=1024;const g=p.frequencyBinCount,A=8*g,E=new Uint8Array(g),I=t.createImageData(2,n.height);for(let e=0;e<I.data.length;e+=8)I.data[e]=0,I.data[e+1]=0,I.data[e+2]=0,I.data[e+3]=255,I.data[e+4]=255,I.data[e+5]=255,I.data[e+6]=255,I.data[e+7]=255;const L=new XMLHttpRequest;L.open("GET",r.path),L.responseType="arraybuffer",L.onload=()=>m.decodeAudioData(L.response,C,P),L.send(),c.innerHTML=r.name;let b,D,h,w,N=m.createBufferSource(),M=0,B=!1;function C(n){"closed"!==m.state&&("suspended"===m.state&&e.postMessage({type:"INFO",message:"Please click the play button - autoplay policy"}),B=!1,b=n,N.buffer=n,h=N.buffer.duration,w=1e3*h,N.connect(m.destination),N.connect(p),N.onended=H,"running"===m.state?(G(),O("PLAYING")):O("READY"),N.start(),D=Date.now(),k(),d.value="0",d.max=w.toString())}function P(n){e.postMessage({type:"error",message:`Error with decoding audio data -> ${n}`})}function T(e){M+=Date.now()-D,0===M&&e<0||M===w&&e>0||(N.onended=null,N.disconnect(m.destination),N.disconnect(p),N=m.createBufferSource(),N.buffer=b,N.connect(m.destination),N.connect(p),N.onended=H,M+=e,M<0&&(M=0),M>w&&(M=w),D=Date.now(),N.start(0,M/1e3),"suspended"===m.state&&Y())}function S(e){M=parseInt(e),M<0&&(M=0),M>w&&(M=w),N.onended=null,N.disconnect(m.destination),N.disconnect(p),N=m.createBufferSource(),N.buffer=b,N.connect(m.destination),N.connect(p),N.onended=H,D=Date.now(),N.start(0,M/1e3),"suspended"===m.state&&Y()}function H(){B=!0,clearTimeout(u),O("ENDED"),cancelAnimationFrame(l),e.postMessage({type:"DONE",message:"Playing ended"})}function O(e){switch(e){case"LOADING":a.textContent="Loading...",a.classList.add("disabled"),a.disabled=!0,o.style.display="none",s.style.display="none",d.style.display="none";break;case"READY":a.innerHTML=PLAY_ICON,a.classList.remove("disabled"),a.disabled=!1,o.style.display="none",s.style.display="none",d.style.display="none";break;case"PAUSED":case"PLAYING":a.innerHTML="PAUSED"===e?PLAY_ICON:PAUSE_ICON,a.classList.remove("disabled"),a.disabled=!1,o.style.display="inline-block",s.style.display="inline-block",d.style.display="block";break;case"ENDED":a.innerHTML=REFRESH_ICON,i.innerHTML=null,o.style.display="none",s.style.display="none",d.style.display="none"}}function k(){"running"===m.state&&(Y(),u=setTimeout(k,1e3))}function Y(){const e=Date.now()-D+M;i.innerHTML=`- ${_(Math.trunc(e/1e3))} | ${_(Math.trunc(h))}`,d.value=e.toString()}function _(e){return(e-(e%=60))/60+(9<e?":":":0")+e}function v(e){const n=e.offsetX/d.clientWidth*w;i.innerHTML=`- ${_(Math.trunc(n/1e3))} | ${_(Math.trunc(h))}`}a.onclick=()=>{"running"!==m.state||B?B?(B=!1,N.onended=null,N.disconnect(m.destination),N.disconnect(p),N=m.createBufferSource(),N.buffer=b,N.connect(m.destination),N.connect(p),N.onended=H,N.start(),G(),D=Date.now(),M=0,k(),O("PLAYING")):m.resume().then((()=>{a.innerHTML=PAUSE_ICON,D=Date.now(),G(),k(),O("PLAYING")})):m.suspend().then((()=>{a.innerHTML=PLAY_ICON,cancelAnimationFrame(l),M+=Date.now()-D,O("PAUSED")}))},o.onclick=()=>T(-5e3),s.onclick=()=>T(5e3),d.oninput=()=>S(d.value),d.onmousemove=e=>v(e);let F=0;function G(){l=requestAnimationFrame(G),p.getByteFrequencyData(E);for(let e=0,n=A;e<g;e++,n-=8)I.data[n]=y.r,I.data[n+1]=y.g,I.data[n+2]=y.b,I.data[n+3]=E[e];t.putImageData(I,F,0),F<f?F++:F=0}return m}(f.data)}))})();