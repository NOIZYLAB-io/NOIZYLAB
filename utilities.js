"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vscode_1=require("vscode"),fs=require("fs"),path=require("path");class Utilities{static readFile(e){try{return fs.existsSync(e)?fs.readFileSync(e,"utf-8"):void 0}catch(e){return}}static getPackagesPath(e){var t=path.join(e,"Library","PackageCache");return fs.existsSync(t)?fs.readdirSync(t).filter(e=>fs.statSync(path.resolve(t,e)).isDirectory):[]}static join(...e){return path.join(...e)}static IsFolder(e){return fs.statSync(e).isDirectory()}static getFiles(e){return fs.existsSync(e)?fs.readdirSync(e):[]}static getProjectRootFolder(e){var t=e.fsPath.indexOf(path.sep+"Assets"+path.sep);if(-1!=t)return e.fsPath.substr(0,t+1)}static getPath(e,t){var r=e.fsPath;let a=path.resolve(r,"..",t);if(fs.existsSync(a))return vscode_1.Uri.file(a);if(-1!=(e=r.indexOf(path.sep+"Assets"+path.sep))){var s=r.substr(0,e+1);if(t.toLowerCase().startsWith("packages"))for(const c of this.getPackagesPath(s)){var i=c.replace(/@[0-9a-zA-Z_\.-]+/,"");if(-1!=t.toLowerCase().indexOf(i.toLowerCase())){var n=t.substr(9);if(-1!=(i=n.replace(/\\/gm,"/").indexOf("/"))&&(n=n.substr(i),a=path.join(s,"Library","PackageCache",c,n),fs.existsSync(a)))return vscode_1.Uri.file(a)}}else a=path.resolve(s,t);if(fs.existsSync(a))return vscode_1.Uri.file(a)}}static translatePackagePath(e,t){var r=this.getProjectRootFolder(e);if(r){var a=t.toLocaleLowerCase();if(a.startsWith("packages")){for(const n of this.getPackagesPath(r)){var s=n.replace(/@[0-9a-zA-Z_\.-]+/,"");if(-1!=t.toLowerCase().indexOf(s.toLowerCase())&&-1!=(s=(i=t.substr(9)).replace(/\\/gm,"/").indexOf("/"))){var i=i.substr(s);return path.join(r,"Library","PackageCache",n,i)}}return path.join(r,"Library","PackageCache")}return a.startsWith("assets")?path.join(r,t):path.resolve(e.fsPath,"..",t)}return path.resolve(e.fsPath,"..",t)}static getIncludeFilesContent(e,t){let r=Utilities.getIncludeFiles(e),a=[];return r.forEach(e=>{!(e=Utilities.getPath(t,e))||(e=Utilities.readFile(e.fsPath))&&a.push(e)}),a}static getDocumentationInIntellisenseConfig(e,t){return(e=e&&t.Items[e])?e.documentation:""}static getMethodNameIfInMethodRange(s,r){if(!(r<0||r>s.length)&&s){let t=1,a=-1;for(let e=r;0<e;e--){var i=s.charAt(e);if(!Utilities.IsWhiteSpace(i)&&(")"===i?t++:"("===i&&t--,0==t)){a=e;break}}if(-1!==a){let t=s.substring(0,a).trim(),r=-1;for(let e=a-1;0<e;e--){var n=t.charAt(e);if(Utilities.IsWhiteSpace(n)||"="===n||"("===n||","===n||";"===n){r=e;break}}if(-1!==r)return t.substring(r+1,a)}}}static getFirstNonSpaceCharInvInText(t,r){if(!(r<0||r>t.length)&&t)for(let e=r;0<e;e--){var a=t.charAt(e);if(!Utilities.IsWhiteSpace(a))return a}}static getFirstNonSpaceTexInv(t,r){var a=t.lineAt(r.line).text;for(let e=r.character-1;0<e;e--){var s=a.charAt(e);if(!Utilities.IsWhiteSpace(s))return t.getText(t.getWordRangeAtPosition(new vscode_1.Position(r.line,e)))}}static getSecondNonSpaceTexInv(t,r){var a=t.lineAt(r.line).text;let s=1;for(let e=r.character-1;0<e;e--){var i=a.charAt(e);if(!Utilities.IsWhiteSpace(i)){if(!(0<s))return t.getText(t.getWordRangeAtPosition(new vscode_1.Position(r.line,e)));(i=t.getWordRangeAtPosition(new vscode_1.Position(r.line,e)))&&(e=i.start.character,s--)}}}static IsWhiteSpace(e){return" "===e||"\t"===e||"\r"===e||"\n"===e}static getMethodCodeLineFromCode(e){return Utilities.getMatchResult(/\b[\d\w_]+?\s+?[\d\w_]+?\s*?\([\s\d\w,_]*?\)\s*?(:[\s\d\w_]+?){0,1}\s*?\{/,e,"gm")}static getVariablesFromCode(e,t){var r="((InputPatch|OutputPatch|RWByteAddressBuffer|RWBuffer|ConsumeStructuredBuffer|ByteAddressBuffer|Buffer|AppendStructuredBuffer|Texture2DMS|Texture2DMSArray|TextureCube|TextureCubeArray|Texture1DArray|RWTexture1DArray|RWTexture2DArray|Texture2DArray|RWTexture2D|Texture2D|StructuctedBuffer|RWStructuredBuffer|RWTexture3D|Texture3D|RWTexture1D|Texture1D)(<[\\w\\d]+?>)?)|SurfaceOutput|appdata_base|appdata_tan|appdata_full|appdata_img|sampler|sampler2D|sampler3D|samplerCUBE|string|triangle|triangleadj|vector|((float|int|uint|bool|half|fixed|double)(\\d*?|\\d*?x\\d*?))",r=t?`(${r}|${t})\\s+?[\\w\\d_]+?\\s*?[;)=,]`:`(${r})\\s+?[\\w\\d_]+?\\s*?[;)=,]`;return Utilities.getMatchResult(new RegExp(r),e,"g")}static getStructDefinationFromCode(e){return Utilities.getMatchResult(/\bstruct\b\s*?[\S]*?\s*?\{[\s\S]*?\}[\s]*?;?/,e,"gm")}static getPropertiesDefinationFromCode(e){return Utilities.getMatchResult(/[_\d\w]+?\s*?\("[\s\S]*?",[\s\S]*?\)\s*?=/,e,"g")}static getIncludeDefinationFromCode(e){return Utilities.getMatchResult(/#include\s*?\"[\s\S]+?\"/,e,"g")}static getIncludeFiles(e){let t=[],r={};var a,s,i=Utilities.getIncludeDefinationFromCode(e);for(a in i){let e=i[a];!e||2<(s=e.split('"')).length&&(r[s[1]]||(t.push(s[1]),r[s[1]]=1))}return t}static getMatchResult(e,t,r){return t.match(new RegExp(e.source,r))}static getParameterInfosFromSignatureCode(t){let r=[];var a=t.replace("(",",").replace(")","").split(",");if(1<a.length)for(var s=1;s<a.length;s++){var i=a[s];let e=new vscode_1.ParameterInformation(t);e.label=i,r.push(e)}return r}static getMethodNameFromSignatureCode(e){var t=e.replace("("," ").split(" ");let r=0;for(let e=0;e<t.length;e++)if(t[e]&&r<1)r++;else if(1===r)return t[e]}static removeEmptyEntry(e){let t=[];return e&&e.forEach(e=>{e.trim()&&t.push(e)}),t}static GetFullRangeOfDocument(e){return e.validateRange(new vscode_1.Range(0,0,Number.MAX_VALUE,Number.MAX_VALUE))}}exports.default=Utilities;