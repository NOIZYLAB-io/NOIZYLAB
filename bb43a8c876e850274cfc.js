import path from"node:path";import{EOL}from"os";import{availableProviders,match}from"./provider.js";import analysis from"./analysis.js";import fs from"node:fs";import{getCustom}from"./tools.js";import.meta.dirname;import*as url from"url";export{parseImageRef}from"./oci_image/utils.js";export{ImageRef}from"./oci_image/images.js";export default{componentAnalysis,stackAnalysis,imageAnalysis,validateToken};export const exhortDevDefaultUrl="https://exhort.stage.devshift.net";export const exhortDefaultUrl="https://rhda.rhcloud.com";function logOptionsAndEnvironmentsVariables(e,t){"true"===process.env.EXHORT_DEBUG&&console.log(`${e}: ${t} ${EOL}`)}function readAndPrintVersionFromPackageJson(){let e;e=import.meta.dirname,e||(e=url.fileURLToPath(new URL(".",import.meta.url)));try{__dirname&&(e=__dirname)}catch(e){console.log("__dirname is not defined, continue with fileUrlPath")}logOptionsAndEnvironmentsVariables("exhort-javascript-api analysis started, version: ",JSON.parse(fs.readFileSync(path.join(e,"..","package.json")).toString()).version)}function selectExhortBackend(e={}){let t;"true"===process.env.EXHORT_DEBUG&&readAndPrintVersionFromPackageJson();let a=getCustom("EXHORT_DEV_MODE","false",e);return t=null!==a&&"true"===a.toString()?getCustom("DEV_EXHORT_BACKEND_URL",exhortDevDefaultUrl,e):exhortDefaultUrl,logOptionsAndEnvironmentsVariables("Chosen exhort backend URL:",t),t}export function testSelectExhortBackend(e){return selectExhortBackend(e)}let theUrl;async function stackAnalysis(e,t=!1,a={}){theUrl=selectExhortBackend(a),fs.accessSync(e,fs.constants.R_OK);let n=match(e,availableProviders);return await analysis.requestStack(n,e,theUrl,t,a)}async function componentAnalysis(e,t={}){theUrl=selectExhortBackend(t),fs.accessSync(e,fs.constants.R_OK),t["manifest-type"]=path.basename(e);let a=match(e,availableProviders);return await analysis.requestComponent(a,e,theUrl,t)}async function imageAnalysis(e,t=!1,a={}){return theUrl=selectExhortBackend(a),await analysis.requestImages(e,theUrl,t,a)}async function validateToken(e={}){return theUrl=selectExhortBackend(e),await analysis.validateToken(theUrl,e)}