import{b as P}from"./chunk-4FRWMI4R.js";import{Gb as V,Ib as $,Jb as U,Kb as G,Lb as J,Mb as j,Oc as l,c as v,d as oe,eb as D,gb as y,hb as s,jb as d,k as L,lb as N,nb as m,p as _,pb as A,wb as E,wc as H,xb as M,yb as q}from"./chunk-V3XRZIHQ.js";var i=v(oe());var ie="https://learn.microsoft.com/sql/database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine",Y="https://aka.ms/sqlopsfirewallhelp";var g="##_addNewMicrosoftAccount_##";var n=v(_());var te=L({ipInputBox:{marginLeft:"8px",marginRight:"8px",width:"120px"}}),Se=({state:e,addFirewallRule:S,closeDialog:K,signIntoAzure:F})=>{let h=te(),c=P(),[a,x]=(0,i.useState)(e.accounts.length>0?e.accounts[0].accountId:""),[Q,O]=(0,i.useState)(e.accounts.length>0?e.accounts[0].displayName:""),[b,w]=(0,i.useState)(a&&e.tenants[a]?.length>0?e.tenants[a][0].tenantId:""),[W,R]=(0,i.useState)(a&&e.tenants[a]?.length>0?e.tenants[a][0].displayName:"");(0,i.useEffect)(()=>{if(e.accounts.length>0){if(a&&e.accounts.find(o=>o.accountId===a))return;let t=e.accounts[0].accountId;if(x(t),O(e.accounts[0].displayName),e.tenants[t]?.length>0){let o=e.tenants[t][0];w(o.tenantId),R(I(o))}}},[JSON.stringify(e.accounts),JSON.stringify(e.tenants)]),(0,i.useEffect)(()=>{e.clientIp&&(z(f(e.clientIp,0)),B(f(e.clientIp,255)))},[e.clientIp]);let[C,X]=(0,i.useState)("ClientIPAddress_"+le(new Date)),[u,Z]=(0,i.useState)("specificIp"),[T,z]=(0,i.useState)(f(e.clientIp,0)),[k,B]=(0,i.useState)(f(e.clientIp,255)),ee=(t,o)=>{o.optionValue===g&&F(),x(o.optionValue??""),O(o.optionText??"");let r=o.optionValue;w(r?e.tenants[r]?.[0]?.tenantId??"":""),R(r&&e.tenants[r]?.[0]?I(e.tenants[r][0]):"")},ne=(t,o)=>{w(o.selectedOptions.length>0?o.selectedOptions[0]:""),R(o.optionText??"")};return(0,n.jsx)(V,{open:!0,children:(0,n.jsx)(J,{children:(0,n.jsxs)(U,{children:[(0,n.jsx)(G,{children:e.serverName?l.firewallRules.createNewFirewallRuleFor(e.serverName):l.firewallRules.createNewFirewallRule}),(0,n.jsxs)(j,{children:[(0,n.jsx)(H,{intent:"error",style:{paddingRight:"12px"},children:e.message}),(0,n.jsx)("br",{}),(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[l.firewallRules.firewallRuleNeededMessage," ",(0,n.jsx)(A,{href:Y,children:l.connectionDialog.readMore})]}),!e.isSignedIn&&(0,n.jsxs)(n.Fragment,{children:[l.firewallRules.signIntoAzureToAddFirewallRule," ",(0,n.jsx)(A,{onClick:()=>{F()},children:l.azure.signIntoAzure})]}),e.isSignedIn&&(0,n.jsxs)(n.Fragment,{children:[e.accounts.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s,{label:l.azure.azureAccount,className:c.formComponentDiv,children:(0,n.jsxs)(N,{value:Q,selectedOptions:[a],onOptionSelect:ee,children:[(0,n.jsx)(d,{text:l.azure.addAzureAccount,value:g,children:l.azure.addAzureAccount},g),e.accounts.map(t=>(0,n.jsx)(d,{text:t.displayName,value:t.accountId,children:t.displayName},t.accountId))]})}),(0,n.jsx)(s,{label:l.azure.tenant,className:c.formComponentDiv,children:(0,n.jsx)(N,{value:W,selectedOptions:[b],onOptionSelect:ne,children:e.tenants[a]?.map(t=>(0,n.jsx)(d,{text:I(t),value:t.tenantId,children:I(t)},t.tenantId))})})]}),(0,n.jsx)(s,{label:l.firewallRules.ruleName,className:c.formComponentDiv,children:(0,n.jsx)(m,{value:C,onChange:(t,o)=>{X(o.value)},id:"ruleName"})}),(0,n.jsx)(s,{className:c.formComponentDiv,children:(0,n.jsxs)(E,{value:u,onChange:(t,o)=>Z(o.value),children:[(0,n.jsx)(M,{label:l.firewallRules.addMyClientIp(e.clientIp),value:"specificIp"}),(0,n.jsx)(M,{label:l.firewallRules.addMySubnetRange,value:"ipRange"})]})}),(0,n.jsxs)("div",{className:c.formComponentDiv,style:{marginLeft:"40px"},children:[(0,n.jsx)(y,{children:"From"}),(0,n.jsx)(m,{value:T,onChange:(t,o)=>{z(o.value)},id:"startIpInput",disabled:u==="specificIp",className:h.ipInputBox}),(0,n.jsx)(y,{children:"To"}),(0,n.jsx)(m,{value:k,onChange:(t,o)=>{B(o.value)},id:"endIpInput",disabled:u==="specificIp",className:h.ipInputBox})]})]})]}),(0,n.jsxs)($,{children:[(0,n.jsx)(D,{appearance:"primary",onClick:()=>{S({name:C,azureAccountInfo:{accountId:a,tenantId:b},ip:u==="specificIp"?e.clientIp:{startIp:T,endIp:k}})},disabled:!e.isSignedIn,icon:e.addFirewallRuleStatus==="loading"?(0,n.jsx)(q,{size:"tiny"}):void 0,children:l.firewallRules.addFirewallRule}),(0,n.jsx)(D,{appearance:"secondary",onClick:()=>{K()},children:l.common.cancel})]})]})})})};function p(e){return e.toString().padStart(2,"0")}function le(e){return[e.getFullYear(),p(e.getMonth()+1),p(e.getDate())].join("-")+"_"+[p(e.getHours()),p(e.getMinutes()),p(e.getSeconds())].join("-")}function I(e){return`${e.displayName} (${e.tenantId})`}function f(e,S){return e.replace(/\.[0-9]+$/g,`.${S}`)}export{ie as a,g as b,Se as c};
