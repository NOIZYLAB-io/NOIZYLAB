{
  "version": 2,
  "name": "NoizyLab OS SuperCode Rules",
  "description": "Auto-writing AI dev assistant rules for NoizyLab OS",
  "rules": [
    {
      "pattern": "*.js",
      "instruction": "Always improve performance, readability, and Cloudflare compatibility. Suggest fixes if ENV or wrangler config is missing. Use ES modules (import/export). Add error handling and logging."
    },
    {
      "pattern": "*.ts",
      "instruction": "Use TypeScript strict mode. Add proper types for Cloudflare Workers API (Request, Response, Env). Ensure compatibility with wrangler.toml bindings."
    },
    {
      "pattern": "workers/**",
      "instruction": "Auto-scan for missing AI bindings, DO bindings, queue bindings, D1 bindings. If missing, generate wrangler.toml patches. Ensure all Workers export default fetch handler. Add proper error handling and CORS headers."
    },
    {
      "pattern": "d1/*.sql",
      "instruction": "Ensure schemas follow Cloudflare D1 standards. Auto-generate safe migrations. Use transactions for multi-statement operations. Add indexes for performance."
    },
    {
      "pattern": "**/wrangler.toml",
      "instruction": "Validate configuration. Ensure all bindings are properly configured. Check for missing environment variables. Verify account_id and zone_id if needed."
    },
    {
      "pattern": "**/.env*",
      "instruction": "Never commit actual credentials. Use .env.example as template. Document all required variables. Add validation for critical variables."
    },
    {
      "pattern": "supercode/**",
      "instruction": "Ensure all scripts are executable. Add proper error handling. Include logging and status reporting. Make scripts idempotent where possible."
    },
    {
      "pattern": "ai/**",
      "instruction": "Add fallback logic for AI provider failures. Implement retry mechanisms. Add rate limiting. Support multiple AI providers (Cloudflare, Gemini, Claude, OpenAI)."
    },
    {
      "pattern": "scripts/**",
      "instruction": "Add bash error handling (set -e). Include logging. Make scripts executable. Add usage documentation. Support dry-run mode where applicable."
    }
  ],
  "onSave": [
    "Validate syntax",
    "Fix dependency imports",
    "Rewrite unstable async functions",
    "Suggest AI provider fallback logic",
    "Enforce NoizyLab OS structural conventions",
    "Add missing error handling",
    "Check for security issues",
    "Validate Cloudflare bindings",
    "Ensure TypeScript types are correct",
    "Add JSDoc comments for public functions"
  ],
  "conventions": {
    "fileStructure": {
      "workers": "Each worker in workers/<name>/ with src/index.ts and wrangler.toml",
      "ai": "AI router in ai/router/, CLI tools in ai/router/bin/",
      "scripts": "All scripts in scripts/ directory",
      "supercode": "Build and deployment scripts in supercode/",
      "migrations": "SQL migrations in migrations/sql/"
    },
    "naming": {
      "workers": "kebab-case (e.g., ai-super-worker)",
      "functions": "camelCase",
      "constants": "UPPER_SNAKE_CASE",
      "files": "kebab-case for scripts, camelCase for modules"
    },
    "codeStyle": {
      "useESModules": true,
      "useTypeScript": true,
      "errorHandling": "Always use try-catch for async operations",
      "logging": "Use console.log with timestamps for debugging",
      "comments": "Add JSDoc for all exported functions"
    }
  },
  "autoFixes": {
    "missingImports": true,
    "unusedVariables": true,
    "typeErrors": true,
    "asyncAwait": true,
    "errorHandling": true
  }
}

